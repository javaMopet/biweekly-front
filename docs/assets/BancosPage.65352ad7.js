import{Q as O,a as Q}from"./QBreadcrumbs.fcd8d044.js";import{C as R,Q as j,a as M}from"./index.804869e1.js";import{r as g,c as E,I as V,ag as D,aK as $,aj as e,ai as s,aM as k,aN as T,aq as l,Q as I,E as L,z as y,am as A,u as G,ah as S,b5 as H,b6 as K,aO as J,ao as U,b8 as W,ak as X,ap as Y}from"./index.20d4ad85.js";import{Q as Z}from"./QImg.df9e647c.js";import{Q as ee}from"./QTooltip.a2dbcdc4.js";import{c as q,u as oe,B as te,f as ae,g as ne,a as le}from"./useCuentasCrud.5ef3cef5.js";import{a as z,Q as se,u as re}from"./useNotificacion.79136029.js";import{s as N}from"./index.27a31e1c.js";import{l as ie,D as ce}from"./DialogTitle.a45c2883.js";import"./format.9422eb17.js";import"./QList.5cb48b53.js";import"./QItemLabel.be9194dc.js";import"./printer.c268160e.js";function F(){const _=q(),B=oe();g({fetchPolicy:"cache-and-network"});const{mutate:c,onDone:m,onError:C}=N(te),{mutate:f,onDone:p,onError:i}=N(ae),{mutate:t,onDone:h,onError:x}=N(ne);return m(({data:d})=>{console.log("refrescando bancos");const u=d.bancoCreate.banco;_.bancoCreated(u)}),p(({data:d})=>{const u=d.bancoUpdate.banco;_.bancoUpdated(u),B.loadOrRefetchListaCuentas()}),h(({data:d})=>{const u=d.bancoDelete.banco;_.bancoDeleted(u)}),i(d=>{ie(d)}),{createBanco:c,updateBanco:f,bancoDelete:t,onDoneCreateBanco:m,onDoneUpdateBanco:p,onDoneDeleteBanco:h,onErrorCreateBanco:C,onErrorUpdateBanco:i,onErrorDeleteBanco:x}}const de={class:"my-card",style:{width:"400px","min-width":"400px"}},ue={class:"q-pa-md"},me={class:"q-gutter-xs"},pe={class:"column items-center"},be={class:"q-gutter-xs q-mt-xs",style:{width:"85%",border:"0px solid red"}},fe={align:"right",class:"q-gutter-x-md q-mt-lg"},ve={__name:"FormRegistroBanco",props:{editedItem:{type:Object,required:!1,default:()=>({id:null})},editedIndex:{type:Number,required:!1,default:-1}},emits:["itemSaved","itemUpdated"],setup(_,{emit:B}){const c=F(),m=z(),C=q(),f=g({nombre:"",identificador:"",bancoContable:null,tipoBanco:{id:"1"}}),p=_,i=B,t=E({get(){return p.editedItem?p.editedItem:f.value},set(o){f.value=o}}),h=E({get(){return t.value.id?"Actualizar Banco":"Nuevo Banco"}}),x=E({get(){return t.value.id?"Actualizar":"Guardar"}});V(()=>{console.table(C.listaBancos)});function d(){console.log("save item",t.value);const o={...t.value,__typename:void 0};if(!t.value.id)console.log("guardando banco nueva",o),c.createBanco({input:o});else{const a=t.value.id;console.log("actualizando banco",a,o),c.updateBanco({id:a,input:o})}}c.onDoneCreateBanco(({data:o})=>{if(console.log("saved data...",o),o){const a=o.bancoCreate.banco;u("guard\xF3",a),i("itemSaved",a)}}),c.onDoneUpdateBanco(({data:o})=>{if(console.log("data updated",o),o){const a=o.bancoUpdate.banco;i("itemUpdated",a),u("actualiz\xF3",a)}});function u(o,a){m.mostrarNotificacionPositiva(`El banco "${a.nombre}" se ${o} correctamente`,1500)}return c.onErrorCreateBanco(o=>{m.mostrarNotificacionNegativa("Surgi\xF3 un error al intentar crear el banco.",1500)}),c.onErrorUpdateBanco(o=>{console.error(o)}),(o,a)=>(D(),$("div",de,[e(ce,null,{default:s(()=>[k(T(h.value),1)]),_:1}),l("div",ue,[e(se,{onSubmit:d,class:""},{default:s(()=>[l("div",me,[l("div",pe,[l("div",be,[l("div",null,[e(I,{modelValue:t.value.nombre,"onUpdate:modelValue":a[0]||(a[0]=b=>t.value.nombre=b),type:"text",dense:"",color:"positive",autofocus:"","lazy-rules":"",rules:[b=>b&&b.length>0||"Favor de ingresar el nombre de la Banco"],label:"* Nombre del banco",outlined:""},null,8,["modelValue","rules"])]),l("div",null,[e(I,{modelValue:t.value.icono,"onUpdate:modelValue":a[1]||(a[1]=b=>t.value.icono=b),type:"text",label:"Nombre de im\xE1gen",color:"positive",dense:"",outlined:""},null,8,["modelValue"])])])]),l("div",fe,[L(e(y,{label:"Cancelar",color:"negative",class:"q-ml-sm","no-caps":"",flat:"",rounded:""},null,512),[[R]]),e(y,{label:x.value,type:"submit",color:"primary-button","no-caps":""},null,8,["label"])])])]),_:1})]),e(A,{class:"q-gutter-sm",align:"right"})]))}};const ge={class:"row items-center q-ml-sm q-gutter-x-sm"},_e={class:"q-pa-md q-gutter-sm"},he={class:"column q-mx-md",style:{border:"0px solid red"}},Be={class:"row fit",style:{border:"0px solid red"}},Ce=l("div",{class:"page-title"},"Bancos",-1),xe={class:"q-pa-md"},ye={class:"row items-center items-between no-wrap"},we={class:"",style:{height:"60px","max-height":"60px","min-height":"60px"}},De={class:"q-ml-md",style:{"text-wrap":"balance"}},Fe={__name:"BancosPage",setup(_){const B=re(),c=z(),m=F(),C=q();m.onDoneDeleteBanco(({data:n})=>{if(n){console.log("item deleted ",n);const v=n.bancoDelete.banco;c.mostrarNotificacionPositiva(`El banco "${v.nombre}" se eliminin\xF3 correctamente`,1500)}}),m.onErrorDeleteBanco(n=>{var w;const r=((w=n==null?void 0:n.toString())!=null?w:"").includes("REFERENCE constraint")?"El banco ha sido utilizado en alguna cuenta, no es posible eliminar":"No es posible eliminar este banco, favor de verificar.";c.mostrarNotificacionNegativa(r,1600)});const f={id:null,nombre:null,descripcion:null,tipoCuenta:{id:null},cuentaContable:null},p=g(),i=g(!1),t=g({...f}),h=g(null),x=g(null),d=[{name:"nombre",label:"Nombre",field:"nombre",sortable:!0,align:"left"},{name:"descripcion",label:"Descripci\xF3n",field:"descripcion",sortable:!0,align:"left"},{name:"acciones",label:"Acciones",field:"action",sortable:!1,align:"center"}];V(()=>{});function u(){t.value={},i.value=!0}function o(n){t.value={...n.row},h.value=n.rowIndex,console.log(t.value),i.value=!0}function a(n){x.value=n.rowIndex,B.dialog({title:"Confirmar",style:"width:500px",message:`Est\xE1 a punto de eliminar el banco "${n.row.nombre}" \xBFEst\xE1 seguro que desea continuar con la eliminaci\xF3n?`,ok:{push:!0,color:"positive",label:"Continuar"},cancel:{push:!0,color:"negative",flat:!0,label:"cancelar"},persistent:!0}).onOk(()=>{m.bancoDelete({id:n.row.id},null,{errorPolicy:"all"})}).onCancel(()=>{}).onDismiss(()=>{})}function b(n){i.value=!1}function P(n){i.value=!1,t.value={...f}}return(n,v)=>(D(),$(J,null,[e(j,{class:"",dense:"",fit:""},{default:s(()=>[l("div",ge,[l("div",_e,[e(O,{class:"breadcrum-component","active-color":"primary",separator:">","separator-color":"primary"},{default:s(()=>[e(Q,{label:"Home",icon:"home",to:"/home"}),e(Q,{label:"Bancos",icon:"account_balance"})]),_:1})])]),e(M)]),_:1}),l("div",he,[l("div",Be,[e(le,{grid:"",style:{width:"100%"},dense:"",rows:G(C).listaBancos,columns:d,"row-key":"id",filter:p.value,"rows-per-page-options":[0],"hide-pagination":""},{"top-left":s(()=>[Ce]),"top-right":s(()=>[l("div",xe,[e(y,{color:"primary-button",label:"Nuevo",onClick:u,push:"",glossy:"","no-caps":"","text-color":"accent-light",icon:"add_circle"})]),e(I,{outlined:"",dense:"",debounce:"300",modelValue:p.value,"onUpdate:modelValue":v[0]||(v[0]=r=>p.value=r),placeholder:"Buscar Cuenta",clearable:"",class:"bg-accent-light"},{append:s(()=>[e(U,{name:"search"})]),_:1},8,["modelValue"])]),item:s(r=>[r.row.deleted?Y("",!0):(D(),S(X,{key:0,class:"bg-white my-card q-ma-sm",flat:"",bordered:"",style:{width:"220px"}},{default:s(()=>[e(A,{class:"q-pa-md"},{default:s(()=>[l("div",ye,[l("div",we,[e(Z,{src:`/icons/${r.row.icono}`,width:"50px"},null,8,["src"])]),l("div",De,T(r.row.nombre),1)])]),_:2},1024),e(W,{align:"right",style:{"border-top":"1px solid #cccccc"},class:"q-py-xs"},{default:s(()=>[e(y,{flat:"",round:"",icon:"las la-edit",class:"button-edit",onClick:w=>o(r)},{default:s(()=>[e(ee,null,{default:s(()=>[k(" Editar ")]),_:1})]),_:2},1032,["onClick"]),e(y,{flat:"",round:"",icon:"las la-trash-alt",class:"button-delete",onClick:w=>a(r)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))]),"body-cell-icono":s(r=>[e(U,{name:r.row.icono,size:"35px",color:"cyan"},null,8,["name"])]),_:1},8,["rows","filter"])]),(D(),S(K,{to:"#modal"},[e(H,{modelValue:i.value,"onUpdate:modelValue":v[1]||(v[1]=r=>i.value=r),persistent:"","transition-show":"jump-up","transition-hide":"jump-down"},{default:s(()=>[e(ve,{"edited-item":t.value,onItemSaved:b,onItemUpdated:P},null,8,["edited-item"])]),_:1},8,["modelValue"])]))])],64))}};export{Fe as default};
