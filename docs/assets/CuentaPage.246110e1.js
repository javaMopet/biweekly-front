import{Q as Ke,a as ge}from"./QBreadcrumbs.fcd8d044.js";import{b as Je,C as xe,a as Se,Q as Ce}from"./index.804869e1.js";import{i as Xe,ac as _e,c as I,g as Ye,ad as We,_ as Ze,t as Ee,l as et,r as p,I as ke,ag as j,aK as $e,aq as i,ah as K,aj as t,ai as r,E as we,bP as be,aM as J,ap as tt,z as U,b5 as Ie,b6 as Ve,aO as Pe,aN as E,ao as Be,aG as ne,b4 as ot,u as B,am as at,b8 as Le,P as De,aI as lt,bQ as st,af as nt,f as ye,bg as it,k as rt,ak as Qe,bv as qe,b7 as ct,Q as Ae,al as ut,bR as dt,b2 as mt,b3 as pt}from"./index.20d4ad85.js";import{Q as Me}from"./QImg.df9e647c.js";import{Q as ft}from"./QItemLabel.be9194dc.js";import{_ as vt,b as Re,a as Ue}from"./CategoriaSelect.674cba46.js";import{d as ht,_ as gt,a as X}from"./FormRegistroCategoria.298f8369.js";import{Q as _t,r as bt,u as se,a as yt,_ as xt,b as St}from"./PeriodoSelect.99389d50.js";import{a as ze,u as Ct,b as wt,O as It}from"./useCuentasCrud.5ef3cef5.js";import{D as v,u as Fe}from"./useFormato.c7e3ed92.js";import{u as Ge,a as Vt,_ as Mt,L as Ft}from"./FormCuentaRegistro.7f001ac3.js";import{r as Te}from"./index.27a31e1c.js";import{a as He,u as kt}from"./useNotificacion.79136029.js";import{D as $t}from"./DialogTitle.a45c2883.js";import{Q as Ot}from"./QInnerLoading.1824423b.js";import{b as Et,Q as Ne,a as je}from"./QList.5cb48b53.js";import"./format.9422eb17.js";import"./QTooltip.a2dbcdc4.js";import"./QBtnToggle.bfaab28d.js";import"./TouchPan.b5696d76.js";import"./QResizeObserver.86d26826.js";import"./FormRegistroCuenta.fba7adc4.js";import"./CuentaContableSelect.d4102a6d.js";import"./printer.c268160e.js";const Dt={position:{type:String,default:"bottom-right",validator:h=>["top-right","top-left","bottom-right","bottom-left","top","right","bottom","left"].includes(h)},offset:{type:Array,validator:h=>h.length===2},expand:Boolean};function Qt(){const{props:h,proxy:{$q:k}}=Ye(),V=Xe(We,_e);if(V===_e)return console.error("QPageSticky needs to be child of QLayout"),_e;const u=I(()=>{const f=h.position;return{top:f.indexOf("top")>-1,right:f.indexOf("right")>-1,bottom:f.indexOf("bottom")>-1,left:f.indexOf("left")>-1,vertical:f==="top"||f==="bottom",horizontal:f==="left"||f==="right"}}),w=I(()=>V.header.offset),b=I(()=>V.right.offset),_=I(()=>V.footer.offset),y=I(()=>V.left.offset),T=I(()=>{let f=0,d=0;const S=u.value,M=k.lang.rtl===!0?-1:1;S.top===!0&&w.value!==0?d=`${w.value}px`:S.bottom===!0&&_.value!==0&&(d=`${-_.value}px`),S.left===!0&&y.value!==0?f=`${M*y.value}px`:S.right===!0&&b.value!==0&&(f=`${-M*b.value}px`);const $={transform:`translate(${f}, ${d})`};return h.offset&&($.margin=`${h.offset[1]}px ${h.offset[0]}px`),S.vertical===!0?(y.value!==0&&($[k.lang.rtl===!0?"right":"left"]=`${y.value}px`),b.value!==0&&($[k.lang.rtl===!0?"left":"right"]=`${b.value}px`)):S.horizontal===!0&&(w.value!==0&&($.top=`${w.value}px`),_.value!==0&&($.bottom=`${_.value}px`)),$}),Q=I(()=>`q-page-sticky row flex-center fixed-${h.position} q-page-sticky--${h.expand===!0?"expand":"shrink"}`);function D(f){const d=Ze(f.default);return Ee("div",{class:Q.value,style:T.value},h.expand===!0?d:[Ee("div",d)])}return{$layout:V,getStickyContent:D}}var qt=et({name:"QPageSticky",props:Dt,setup(h,{slots:k}){const{getStickyContent:V}=Qt();return()=>V(k)}});const At={class:"row inline fit"},Rt={__name:"TipoMovimientoSelect",props:{modelValue:{type:Object,required:!0,default:()=>({})},tipoAfectacion:{type:String,required:!1,default:null},isCambiable:{type:Boolean,required:!1,default:!0}},emits:["update:modelValue","categoriaSaved"],setup(h,{emit:k}){const V=h,u=p("1"),w=p(),b=p(),_=p(V.tipoAfectacion),y=p(!1),T=p({tipoMovimientoId:u.value});ke(()=>{u.value=V.tipoAfectacion==="A"?"1":"2"});const Q=k,D=I({get(){return V.modelValue},set(x){Q("update:modelValue",x)}}),f=I({get(){return u.value==="1"||u.value==="2"}});function d(x){switch(console.log("val",x),x){case"1":_.value="A";break;case"2":_.value="C"}}function S(x){D.value={tipoMovimientoId:u.value,value:x}}function M(){T.value={tipoMovimientoId:u.value,cuentaContable:null,cuentaDefault:null,icono:"insert_emoticon",color:"#019A9D"},y.value=!0}function $(x){y.value=!1,w.value=x,D.value={tipoMovimientoId:u.value,value:x},Q("categoriaSaved",x)}return(x,g)=>(j(),$e(Pe,null,[i("div",At,[f.value?(j(),K(vt,{key:0,modelValue:w.value,"onUpdate:modelValue":[g[0]||(g[0]=m=>w.value=m),S],"tipo-afectacion":_.value,agregar:!1},null,8,["modelValue","tipo-afectacion"])):(j(),K(ht,{key:1,modelValue:b.value,"onUpdate:modelValue":[g[1]||(g[1]=m=>b.value=m),S],label:"Cuenta Destino","filter-array":["1","2"]},null,8,["modelValue"])),t(U,{round:"",icon:"more_vert","no-caps":"",flat:"",class:"text-condensed more-button"},{default:r(()=>[t(Je,{dark:""},{default:r(()=>[t(Et,{style:{"min-width":"100px"}},{default:r(()=>[we((j(),K(Ne,null,{default:r(()=>[t(je,null,{default:r(()=>[t(be,{modelValue:u.value,"onUpdate:modelValue":[g[2]||(g[2]=m=>u.value=m),d],val:"1",label:"Ingreso","checked-icon":"task_alt","unchecked-icon":"panorama_fish_eye",color:"positive-pastel",dark:""},null,8,["modelValue"]),t(be,{modelValue:u.value,"onUpdate:modelValue":[g[3]||(g[3]=m=>u.value=m),d],val:"2",label:"Egreso","checked-icon":"task_alt","unchecked-icon":"panorama_fish_eye",color:"negative-pastel",dark:""},null,8,["modelValue"]),t(be,{modelValue:u.value,"onUpdate:modelValue":[g[4]||(g[4]=m=>u.value=m),d],val:"3",label:"Traspaso","checked-icon":"task_alt","unchecked-icon":"panorama_fish_eye",color:"contrast",dark:""},null,8,["modelValue"])]),_:1})]),_:1})),[[xe]]),f.value?we((j(),K(Ne,{key:0,clickable:"",onClick:M},{default:r(()=>[t(je,{class:"text-positive-pastel"},{default:r(()=>[J(" Agregar categor\xEDa ")]),_:1})]),_:1})),[[xe]]):tt("",!0)]),_:1})]),_:1})]),_:1})]),(j(),K(Ve,{to:"#modal"},[t(Ie,{modelValue:y.value,"onUpdate:modelValue":g[5]||(g[5]=m=>y.value=m),persistent:"","transition-show":"jump-up","transition-hide":"jump-down"},{default:r(()=>[t(gt,{"edited-item":T.value,onCategoriaSaved:$},null,8,["edited-item"])]),_:1},8,["modelValue"])]))],64))}};const Ut={class:"my-card",style:{width:"90%","min-width":"90%","max-width":"90%"}},Tt={class:"main-content q-py-lg"},Nt={class:"q-pa-lg cuenta-content"},jt={class:"row q-pr-lg justify-between"},Pt={class:"column"},Bt=i("div",{class:"form-input__label"}," Selecciona un archivo en formato Excel: ",-1),Lt={class:"row items-center q-gutter-x-md"},zt={class:"column"},Gt=i("span",{class:"form-input__label"}," Desde:",-1),Ht={class:"column"},Kt=i("span",{class:"form-input__label"},"Hasta:",-1),Jt={class:"column col"},Xt={class:"row justify-between items-center full-width",style:{border:"0px solid green"}},Yt={class:"",style:{border:"0px solid red"}},Wt=i("span",{class:"text-bold text-primary"}," Importe Total:",-1),Zt={class:"q-pl-md text-secondary text-bold"},eo={class:"row q-gutter-x-lg"},to={__name:"ImportarRegistrosCuenta",props:{cuenta:{type:Object,required:!0,default:()=>({})},fecha_desde:{type:String,required:!0,default:()=>null},fecha_hasta:{type:String,required:!0,default:()=>null}},emits:["itemsSaved"],setup(h,{emit:k}){const V=He(),u=Ge(),w=p(null),b=p([]),_=p([]),y=p(),T=p([]),Q=p("01/01/1900"),D=p("01/01/1900"),f=p(!1),d=Fe(),S=h;ke(()=>{let a=d.formatoFechaFromISO(S.fecha_desde),n=d.formatoFechaFromISO(S.fecha_hasta);Q.value=a,D.value=n});const M=k;async function $(a){try{const n=a.target.files;if(!n||n.length==0)return;const e=bt(await n[0].arrayBuffer()),c=se.sheet_to_json(e.Sheets[e.SheetNames[0]],{raw:!1});if(S.cuenta.banco)switch(S.cuenta.banco.id){case 1:g(e);break;case 2:m(e);break;default:break}else P(e)}catch(n){console.log(n)}}function x(){return b.value.length===0?"":`${b.value.length} registro${b.value.length>1?"s":""} seleccionados. Importe: ${d.toCurrency(ve.value)} `}function g(a){const n=se.sheet_to_json(a.Sheets[a.SheetNames[0]],{header:["A","B","C","D","E","F","G","H"],skipHeader:!0,raw:!1}),e=new Map;e.set("Ene","01"),e.set("Feb","02"),e.set("Mar","03"),e.set("Abr","04"),e.set("May","05"),e.set("Jun","06"),e.set("Jul","07"),e.set("Ago","08"),e.set("Sep","09"),e.set("Oct","10"),e.set("Nov","11"),e.set("Dic","12"),y.value=n.map(c=>({fecha:c.A,concepto:c.D,retiro:c.E,deposito:c.F,saldo:c.G,referencia:c.H})),y.value.forEach((c,F)=>{let O=c.fecha.toString();for(const[A,q]of e)O=O.replace(A.toString(),q.toString());if(console.log("fecha",O),v.fromFormat(O,"dd/MM/yyyy").isValid){const A=c.retiro>0?"C":c.deposito>0?"A":"N/A",q=c.retiro>0?parseFloat(c.retiro)*-1:c.deposito>0?parseFloat(c.deposito):0,R={id:F,consecutivo:F+1,tipo_afectacion:A,fecha:O,concepto:c.concepto,importe:q,saldo:c.saldo,referencia:c.referencia,tipoMovimiento:{}};_.value.push(R)}})}function m(a){const n=se.sheet_to_json(a.Sheets[a.SheetNames[0]],{header:["A","B","C","D","E"],skipHeader:!0,raw:!1});y.value=n.map(e=>({fecha:e.A,concepto:e.B,cargo:e.C,abono:e.D,saldo:e.E})),y.value.forEach((e,c)=>{var z,A;let F=e.fecha.toString();if(v.fromFormat(F,"dd/MM/yyyy").isValid){const q=(z=e.cargo)==null?void 0:z.replace(",",""),R=(A=e.abono)==null?void 0:A.replace(",",""),ee=q?"C":R?"A":"N/A";e.consecutivo=c;const G=q?parseFloat(q):R?parseFloat(R):0;Y(e,c,F,G,ee)}}),console.table(_.value)}function P(a){const n=se.sheet_to_json(a.Sheets[a.SheetNames[0]],{header:["A","B","C","D","E","F"],skipHeader:!0,raw:!1});y.value=n.map(e=>({consecutivo:e.A,fecha:e.B,concepto:e.C,cargo:e.D,abono:e.E,saldo:e.F})),console.table(y.value),y.value.forEach((e,c)=>{var z,A,q,R,ee;let F=((z=e.fecha)==null?void 0:z.toString())||"",O=v.fromFormat(F,"dd/MM/yyyy");if(O.isValid||(O=v.fromFormat(F,"dd-MM-yyyy")),O.isValid){const G=parseFloat((q=(A=e.cargo)==null?void 0:A.replace(",",""))!=null?q:0),o=parseFloat((ee=(R=e.abono)==null?void 0:R.replace(",",""))!=null?ee:0);if(console.log("cargo y abono: ",G,o),G!==0&&o!==0){console.trace("error en la linea");return}let l=null,s=0;G!==0?(l="C",s=G*-1):(l="A",s=o),Y(e,c,F,s,l)}}),console.table(_.value)}function Y(a,n,e,c,F){console.log("fecha",e);const O={id:n,consecutivo:a.consecutivo,tipo_afectacion:F,fecha:e,concepto:a.concepto,importe:c,saldo:a.saldo,saved:!1,isValid:!0};_.value.push(O)}function te(){var a=[],n=["1","2"];const e=De.getItem("user").id;return N.value.forEach(c=>{if(console.log("recorriendo arreglo"),console.dir(c.tipoMovimiento),n.indexOf(c.tipoMovimiento.tipoMovimientoId)!==-1){const F=L(c.fecha);a.push({estadoRegistroId:2,tipoAfectacion:W(c.tipoMovimiento.tipoMovimientoId),cuentaId:S.cuenta.id,categoriaId:c.tipoMovimiento.value.id,importe:parseFloat(c.importe),fecha:F.toISODate(),observaciones:c.concepto,userId:e})}}),a}function L(a){return v.fromFormat(a,"dd/MM/yyyy").isValid?v.fromFormat(a,"dd/MM/yyyy"):v.fromFormat(a,"dd-MM-yyyy")}function W(a){return a==="1"?"A":"C"}function ie(){var a=[];return N.value.forEach(n=>{const e=v.fromFormat(n.fecha,"dd/MM/yyyy"),c=De.getItem("user").id;n.tipoMovimiento.tipoMovimientoId==="3"&&a.push({fecha:e,observaciones:"Traspaso entre cuentas",userId:c,traspasoDetalles:[{cuentaId:parseInt(n.tipoMovimiento.value.id),tipoCuentaTraspasoId:1,importe:n.importe*-1},{cuentaId:parseInt(S.cuenta.id),tipoCuentaTraspasoId:2,importe:n.importe}]})}),a}function le(){if(console.table(N.value),ue())setTimeout(()=>{T.value.length=0,N.value.forEach(c=>{c.isValid=!0})},4e3);else{var n=te(),e=ie();re(n,e)}}function re(a,n){console.table(a),console.table(n),f.value=!0,u.importarRegistros({registrosInput:a,traspasosInput:n})}u.onDoneImportarRegistros(({data:a})=>{console.dir(a),ce()});function ce(){V.mostrarNotificacionPositiva("Los movimientos se guardaron correctamente.",1700),M("itemsSaved")}u.onErrorImportarRegistros(a=>{f.value=!1,V.mostrarNotificacionNegativa("Ocurri\xF3 un error el intentar guardar los movimientos",1500),console.log("Ocurri\xF3 un error"),console.table("error",a.graphQLErrors[0]),console.table("error",a.graphQLErrors[0].extensions)});function ue(){return N.value.length<=0&&oe(0,null,"No hay datos para guardar"),N.value.forEach(a=>{a.tipoMovimiento?a.tipoMovimiento.value?a.isValid=!0:(oe(1,a.consecutivo,"Favor de ingresar los valores requeridos"),a.isValid=!1):(oe(1,a.consecutivo,"Favor de agregar categoria"),a.isValid=!1)}),T.value.length>0}function oe(a,n,e){T.value.push({code:a,numero_linea:n,message:e})}function de(){console.log("eliminar seleccionados",b.value),b.value.forEach(a=>{var n=_.value.indexOf(a);n!==-1&&_.value.splice(n,1)}),b.value.length=0}function me(a){const n=_.value.findIndex(e=>e.id==a.row.id);_.value.splice(n,1)}function ae(){_.value.length=0}const pe=I({get(){return b.value.length>0}}),N=I({get(){const a=v.fromFormat(Q.value,"dd/MM/yyyy"),n=v.fromFormat(D.value,"dd/MM/yyyy");return _.value.filter(e=>{const c=v.fromFormat(e.fecha,"dd/MM/yyyy").isValid?v.fromFormat(e.fecha,"dd/MM/yyyy"):v.fromFormat(e.fecha,"dd-MM-yyyy");return c>=a&&c<=n})}}),fe=I({get(){return N.value.reduce((a,n)=>a+parseFloat(n.importe),0)}}),ve=I({get(){return b.value.reduce((a,n)=>a+parseFloat(n.importe),0)}}),Z=[{name:"consecutivo",label:"No.",field:"consecutivo",sortable:!0,align:"left",filter:!1,headerStyle:"width:40px;max-width:40px"},{name:"fecha",label:"Fecha",field:"fecha",sortable:!0,align:"left",filter:!1,headerStyle:"width:100px;max-width:100px",style:"width:100px;max-width:100px"},{name:"concepto",label:"Concepto",field:"concepto",sortable:!0,align:"left",filter:!0},{name:"importe",label:"Importe",field:"importe",sortable:!0,align:"right",headerStyle:"width:100px;max-width:100px"},{name:"categoria",label:"Categoria",field:"categoria",sortable:!0,align:"center",headerStyle:"width:400px;max-width:400px",style:"width:400px;max-width:400px"},{name:"acciones",label:"",field:"action",sortable:!1,align:"center",style:"width:5%"}];function he(){console.log("La categoria fue guardada correctamente")}return(a,n)=>(j(),$e("div",Ut,[t(Ot,{showing:f.value,label:"Saving... Please wait...","label-class":"text-teal","label-style":"font-size: 1.1em",style:{"z-index":"500"}},null,8,["showing"]),t($t,null,{default:r(()=>[J("Cuenta \xA0\xA0~ "+E(h.cuenta.nombre)+" ~",1)]),_:1}),i("div",Tt,[i("div",Nt,[t(Ce,{class:"q-gutter-x-md"},{default:r(()=>[i("div",jt,[i("div",Pt,[Bt,t(_t,{modelValue:w.value,"onUpdate:modelValue":n[0]||(n[0]=e=>w.value=e),label:"Carga archivo Excel",accept:".xlsx,.xls",onInput:$,dense:"",style:{width:"450px"},"max-files":"1",outlined:"","no-caps":"","label-color":"primary",clearable:"",onClear:ae},{prepend:r(()=>[t(Be,{color:"primary",name:"cloud_upload"})]),before:r(()=>[t(Me,{src:"/icons/excel2.png",width:"24px"})]),_:1},8,["modelValue"])])]),t(ne,{vertical:""}),i("div",Lt,[i("div",zt,[Gt,t(Re,{modelValue:Q.value,"onUpdate:modelValue":n[1]||(n[1]=e=>Q.value=e),lbl_field:"Fecha",opcional:!1,style:{width:"140px"}},null,8,["modelValue"])]),i("div",Ht,[Kt,t(Re,{modelValue:D.value,"onUpdate:modelValue":n[2]||(n[2]=e=>D.value=e),lbl_field:"Fecha",opcional:!1,style:{width:"140px"}},null,8,["modelValue"])])]),t(Se),t(U,{color:"negative",disable:!pe.value,icon:"las la-trash-alt",label:"Eliminar",onClick:de,dense:""},null,8,["disable"])]),_:1}),t(qt,{position:"top",style:{"z-index":"100",width:"600px"},offset:[508,68],expand:""}),t(at,{style:{"max-height":"60vh",height:"60vh"},class:"scroll"},{default:r(()=>[t(ze,{rows:N.value,columns:Z,"rows-per-page-options":[0],"row-key":"consecutivo",dense:"",separator:"cell",selection:"multiple",selected:b.value,"onUpdate:selected":n[3]||(n[3]=e=>b.value=e),"selected-rows-label":x,"table-header-class":"text-accent text-condensed bg-primary-light","no-data-label":"No existen datos disponibles","hide-pagination":"",class:"my-sticky-header-table"},{"body-cell-categoria":r(e=>[t(X,{props:e},{default:r(()=>[i("div",Jt,[i("div",null,[t(Rt,{modelValue:e.row.tipoMovimiento,"onUpdate:modelValue":c=>e.row.tipoMovimiento=c,"tipo-afectacion":e.row.tipo_afectacion,onCategoriaSaved:he},null,8,["modelValue","onUpdate:modelValue","tipo-afectacion"])])])]),_:2},1032,["props"])]),"body-cell-importe":r(e=>[t(X,{props:e},{default:r(()=>[i("span",{class:ot([e.row.importe>0?"importe_positivo":"importe_negativo"])},E(B(d).toCurrency(parseFloat(e.row.importe))),3)]),_:2},1032,["props"])]),"body-cell-acciones":r(e=>[t(X,{props:e,fit:"",class:"bg-white"},{default:r(()=>[t(U,{icon:"las la-trash-alt",size:"md",class:"q-ml-sm",color:"negative",dense:"",onClick:c=>me(e),flat:""},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","selected"])]),_:1}),t(Le,{style:{border:"0px solid red"}},{default:r(()=>[i("div",Xt,[i("div",Yt,[Wt,i("span",Zt,E(B(d).toCurrency(fe.value)),1)]),i("div",eo,[we(t(U,{flat:"",label:"Cancelar","no-caps":"",color:"negative",rounded:""},null,512),[[xe]]),t(U,{label:"Guardar",color:"primary-button",onClick:le,"no-caps":""})])])]),_:1})])])]))}};const H=h=>(mt("data-v-4bbe4140"),h=h(),pt(),h),oo={class:"row items-center q-ml-sm q-gutter-x-sm"},ao={class:"q-pa-md q-gutter-sm"},lo={class:"row inline fit items-center justify-between q-px-xl q-pt-md"},so={class:"row items-center q-gutter-md"},no={class:"cuenta__title"},io=H(()=>i("span",{class:"cuenta__title text-accent"},"Cuenta",-1)),ro={class:"main-content"},co={class:"cuenta-content"},uo={class:"col column items-center"},mo=H(()=>i("span",{class:"resumen__etiqueta"}," Periodo ",-1)),po={class:"resumen__valor"},fo={class:"col column items-center"},vo=H(()=>i("span",{class:"resumen__etiqueta"}," Saldo del periodo anterior",-1)),ho={class:"resumen__valor"},go={class:"col column items-center"},_o=H(()=>i("span",{class:"resumen__etiqueta"}," Balance del periodo",-1)),bo={class:"resumen__valor"},yo={class:"col column items-center"},xo=H(()=>i("span",{class:"resumen__etiqueta"}," Saldo al final del periodo",-1)),So={class:"resumen__valor"},Co={class:"col column items-center"},wo=H(()=>i("span",{class:"resumen__etiqueta"}," Saldo al d\xEDa",-1)),Io={class:"q-gutter-x-sm"},Vo={class:"resumen__valor",style:{"font-weight":"bold !important"}},Mo={class:"sticky-table-container"},Fo=H(()=>i("div",{class:"table-title"},"Movimientos del periodo",-1)),ko={class:"row q-gutter-x-sm"},$o=H(()=>i("span",{class:"q-ml-sm"},"Importar",-1)),Oo={class:"summary"},Eo={__name:"CuentaPage",setup(h){const k=st(),V=nt(),u=Fe(),w=Ge(),b=kt();Vt();const _=Ct(),y=wt(),T=yt(),{mostrarNotificacionPositiva:Q,mostrarNotificacionNegativa:D}=He(),{toCurrency:f}=Fe(),d=ye({categoriaId:null,cuentaId:k.params.id,fechaInicio:v.now().startOf("month").toISODate(),fechaFin:v.now().endOf("month").toISODate(),isMsi:null}),S=ye({cuentaId:k.params.id,fechaFin:v.now().startOf("month").plus({days:-1}).toISODate()}),M=p({}),$=p([]),x=p(v.now().year),g=p({}),m=p(null),P=p([]),Y=p(0),te=p(),L=p(!1),W=p(!1);it(()=>{console.log("On before mount ..............")}),ke(()=>{console.log("On mounted ................"),g.value=T.meses.find(o=>o.id===v.now().month),ie(k.params.id)});function ie(o){rt.get(`/cuentas/${o}`).then(l=>{var s;M.value=(s=l==null?void 0:l.data.data)!=null?s:{}})}const le=ye({fetchPolicy:"no-cache"}),{onError:re,onResult:ce,refetch:ue}=Te(Ft,d,le);ce(({data:o})=>{var l;o&&(console.log("on result lista registros....."),$.value=(l=o==null?void 0:o.obtenerRegistros)!=null?l:[])}),re(o=>{D("Ocurri\xF3 un error, no se pueden obtener los detalles de la cuenta")});const{onResult:oe,onError:de,refetch:me}=Te(It,S,le);oe(({data:o})=>{o&&(console.log("onResultObtenerSaldoAFecha anterior....."),Y.value=o.obtenerSaldoAFecha)}),de(o=>{D("Ocurri\xF3 un error, no se puede obtener el saldo")});const ae=I({get(){return $.value.reduce((o,l)=>o+l.importe,0)}}),pe=I({get(){return Y.value+ae.value}}),N=I({get(){const o=v.fromISO(d.fechaInicio),l=v.fromISO(d.fechaFin),s=v.now();return o<=s&&s<=l?void 0:d.fechaFin}}),fe=I({get(){var o,l;return`01/${(l=(o=g.value)==null?void 0:o.nombre)==null?void 0:l.substring(0,3)}/${x.value}`}}),ve=I({get(){var l,s;return`${v.fromISO(d.fechaFin).day}/${(s=(l=g.value)==null?void 0:l.nombre)==null?void 0:s.substring(0,3)}/${x.value}`}});function Z(){ue(),me(),R()}function he(o){var l;m.value=JSON.parse(JSON.stringify(o.row)),m.value.importe=a(m.value).toString(),m.value.fecha=u.convertDateFromIsoToInput(m.value.fecha),m.value.tipoMovimientoId=((l=m.value.categoria)==null?void 0:l.tipoMovimientoId)||"3",console.log("item to edit",m.value),L.value=!0}function a(o){return console.log("obtenerImporteByTipoMovimiento item...",o),o.categoria?o.categoria.tipoMovimientoId==="2"?o.importe*-1:o.importe:o.traspasoDetalle?o.traspasoDetalle.importe:""}function n(){if(P.value.length>0){const o=`Esta a punto de eliminar ${P.value.length} movimientos. \xBFDesea continuar?`;b.dialog({title:"Confirmar",style:"width:500px",message:o,ok:{push:!0,color:"positive",label:"Continuar"},cancel:{push:!0,color:"negative",flat:!0,label:"cancelar"},persistent:!0}).onOk(()=>{e(P.value)}).onCancel(()=>{}).onDismiss(()=>{})}}function e(o){console.log(o);const l=o.map(s=>s.id);console.log("eliminando",l.toString()),w.registrosDelete({ids:l.toString()})}w.onDoneRegistrosDelete(({data:o})=>{console.log("Termin\xF3 de eliminar registros",o.registrosDelete.cuentasIds),_.actualizarSaldoCuenta(M.value.id.toString(),o.registrosDelete.saldo),Z(),Q("Los movimientos fueron eliminados exitosamente",1600),P.value.length=0}),w.onErrorRegistrosDelete(()=>{D("No es posible eliminar los registros, favor de verificar.",2100)});function c(){console.log("Periodo cambiado",x.value,g.value);const o=`${x.value}-${("0"+g.value.id).slice(-2)}-01`,l=v.fromISO(o);d.fechaInicio=l.toISODate(),d.fechaFin=l.endOf("month").toISODate(),S.fechaFin=l.startOf("month").plus({days:-1}).toISODate()}function F(){m.value={tipoMovimientoId:"2",tipoAfectacion:"C",categoria:null,estadoRegistroId:2,importe:"",fecha:u.formatoFecha(new Date),observaciones:"",cuenta:M.value},L.value=!0}function O(o,l,s){const C={...l,observaciones:s,cuentaId:l.cuenta.id,categoriaId:l.categoria.id,cuenta:void 0,categoria:void 0,__typename:void 0,registroTarjeta:void 0,traspasoDetalle:void 0};w.registroUpdate({id:o,input:C})}w.onDoneRegistroUpdate(o=>{Q("Campo observaci\xF3n actualizado.",700)}),w.onErrorRegistroUpdate(o=>{console.trace(o)});function z(o){Z(),L.value=!1}function A(){Z(),L.value=!1}function q(){W.value=!1,Z()}function R(){y.cuentaSaldoUpdate({cuentaId:k.params.id.toString()})}y.onDoneCuentaSaldoUpdate(({data:o})=>{M.value.saldo=o.cuentaSaldoUpdate.cuenta.saldo});function ee(){W.value=!0}const G=[{name:"fecha",label:"Fecha",field:"fecha",sortable:!0,align:"left",format:(o,l)=>u.formatoFechaFromISO(o),headerStyle:"width: 90px"},{name:"categoria",label:"Concepto",field:o=>{var l;return(l=o.categoria)==null?void 0:l.nombre},sortable:!1,filter:!1,align:"left"},{name:"cargo",label:"Cargo",field:"cargo",sortable:!0,align:"right",format:(o,l)=>u.toCurrency(o),headerStyle:"width: 100px; min-width:100px"},{name:"abono",label:"Abono",field:"abono",sortable:!0,align:"right",format:(o,l)=>u.toCurrency(o),headerStyle:"width: 100px; min-width:100px"},{name:"observaciones",label:"Observaciones",field:"observaciones",sortable:!0,align:"left",headerStyle:"width:250px;max-width: 250px",style:"width:250px;max-width: 250px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis"},{name:"tarjetaCredito",label:"Tarjeta de Cr\xE9dito",field:o=>{var l;return(l=o.registroTarjeta)==null?void 0:l.cuenta.nombre},sortable:!0,align:"left",headerStyle:"width: 120px;min-width:120px;max-width:120px"},{name:"acciones",field:"action",sortable:!1,align:"center",headerStyle:"width: 70px"}];return(o,l)=>(j(),$e(Pe,null,[t(Qe,{flat:"",class:"bg-main-background"},{default:r(()=>{var s,C;return[t(Ce,{class:"text-primary",fit:"",dense:""},{default:r(()=>[i("div",oo,[i("div",ao,[t(Ke,{class:"breadcrum-component","active-color":"primary",separator:">","separator-color":"primary"},{default:r(()=>[t(ge,{icon:"home",to:"/"}),t(ge,{label:"Cuentas",icon:"account_balance",to:"/cuentas"}),t(ge,{label:M.value.nombre,icon:"account_balance_wallet"},null,8,["label"])]),_:1})])]),t(Se),t(U,{color:"primary",icon:"las la-arrow-circle-left",onClick:l[0]||(l[0]=Oe=>B(V).go(-1)),flat:"",rounded:"","no-caps":"",label:"Regresar"})]),_:1}),i("div",lo,[i("div",so,[t(Me,{src:`/icons/${(C=(s=M.value.banco)==null?void 0:s.icono)!=null?C:"cash.png"}`,width:"50px",height:"50px"},null,8,["src"]),i("span",no,E(M.value.nombre),1)]),io])]}),_:1}),i("div",ro,[i("div",co,[t(Qe,{class:"my-card",flat:"",bordered:""},{default:r(()=>[t(Ce,{class:""},{default:r(()=>[t(xt,{year:x.value,"onUpdate:year":l[1]||(l[1]=s=>x.value=s),month:g.value,"onUpdate:month":l[2]||(l[2]=s=>g.value=s),onOnChangePeriodo:c},null,8,["year","month"]),t(Se)]),_:1}),t(Le,{class:"row bg-white full-width text-accent text-subtitle2 resumen",bordered:"",style:{border:"0px solid red"}},{default:r(()=>[t(ft,{class:"q-pr-md"},{default:r(()=>[J(" RESUMEN: \xA0 ")]),_:1}),i("div",uo,[mo,i("span",po,E(fe.value)+" - "+E(ve.value),1)]),t(ne,{spaced:"",inset:"",vertical:""}),i("div",fo,[vo,i("span",ho,E(B(u).toCurrency(Y.value)),1)]),t(ne,{spaced:"",inset:"",vertical:""}),i("div",go,[_o,i("span",bo,E(B(u).toCurrency(ae.value)),1)]),t(ne,{spaced:"",inset:"",vertical:""}),i("div",yo,[xo,i("span",So,E(B(u).toCurrency(pe.value)),1)]),i("div",Co,[wo,i("div",Io,[i("span",Vo,E(B(u).toCurrency(M.value.saldo)),1),t(U,{class:"small-button",color:"primary",icon:"las la-redo-alt",onClick:R,flat:""})])])]),_:1})]),_:1}),i("div",Mo,[t(ze,{class:"q-mt-lg my-sticky-header-table",rows:$.value,columns:G,dense:"","rows-per-page-options":[0],"table-header-class":"bg-primary-light text-accent",separator:"vertical","hide-pagination":"",selection:"multiple",selected:P.value,"onUpdate:selected":l[4]||(l[4]=s=>P.value=s),"row-key":"id",filter:te.value,"no-data-label":"No se han registrado movimientos"},{"header-selection":r(s=>[t(qe,{modelValue:s.selected,"onUpdate:modelValue":C=>s.selected=C,dense:""},null,8,["modelValue","onUpdate:modelValue"])]),"body-selection":r(s=>[t(qe,{modelValue:s.selected,"onUpdate:modelValue":C=>s.selected=C,disable:s.row.disable,dense:""},null,8,["modelValue","onUpdate:modelValue","disable"])]),"top-left":r(()=>[t(Ue,{class:"cuenta__data-subtitle"},{default:r(()=>[Fo]),_:1})]),"top-right":r(()=>[t(Ue,null,{default:r(()=>[i("div",ko,[t(U,{class:"medium-button",color:"negative-pastel",disable:P.value.length<=0,"no-caps":"",label:"Eliminar",onClick:n,icon:"las la-trash",rounded:"",push:""},null,8,["disable"]),t(U,{class:"medium-button",color:"primary-button","no-caps":"",label:"Nuevo",onClick:F,icon:"add_circle",rounded:"",push:""}),t(U,{color:"primary-button",onClick:ee,"no-caps":"",rounded:"",outline:""},{default:r(()=>[t(ct,{square:"",size:"24px"},{default:r(()=>[t(Me,{src:"/icons/excel.png",width:"24px",height:"24px"})]),_:1}),$o]),_:1}),t(Ae,{outlined:"",dense:"",debounce:"300",modelValue:te.value,"onUpdate:modelValue":l[3]||(l[3]=s=>te.value=s),placeholder:"Buscar",clearable:"",class:"bg-accent-light",style:{width:"180px","min-width":"180px"}},{append:r(()=>[t(Be,{name:"search"})]),_:1},8,["modelValue"])])]),_:1})]),"body-cell-categoria":r(s=>[t(X,{key:"categoria",props:s},{default:r(()=>{var C;return[J(E((C=s.row.categoria)==null?void 0:C.nombre),1)]}),_:2},1032,["props"])]),"body-cell-importe":r(s=>[t(X,{class:"registros__columna--importe",style:ut({color:s.row.importe<0?"red":"black"}),align:"right"},{default:r(()=>[J(E(B(u).toCurrency(s.row.importe)),1)]),_:2},1032,["style"])]),"body-cell-observaciones":r(s=>[t(X,{key:"observaciones",props:s},{default:r(()=>[J(E(s.row.observaciones)+" ",1),t(St,{modelValue:s.row.observaciones,"onUpdate:modelValue":[C=>s.row.observaciones=C,C=>O(s.row.id,s.row,s.row.observaciones)],title:"Editar observaciones",buttons:"","label-set":"Guardar","label-cancel":"Cancelar","max-width":"150px"},{default:r(C=>[t(Ae,{modelValue:C.value,"onUpdate:modelValue":Oe=>C.value=Oe,onKeyup:dt(C.set,["enter"]),type:"text",label:"Favor de ingresar observaciones",autofocus:""},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-acciones":r(s=>[t(X,{props:s,class:"q-gutter-x-md"},{default:r(()=>[t(U,{icon:"las la-edit",class:"button-edit",dense:"",onClick:C=>he(s),flat:""},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","selected","filter"])]),i("div",Oo,[J(" Importe total de movimientos: "),i("span",null,E(B(f)(ae.value)),1)])])]),(j(),K(Ve,{to:"#modal"},[t(Ie,{modelValue:L.value,"onUpdate:modelValue":l[5]||(l[5]=s=>L.value=s),persistent:"","transition-show":"jump-up","transition-hide":"jump-down"},{default:r(()=>[t(Mt,{"cuenta-id":M.value.id,"edited-item":m.value,onItemSaved:z,onItemUpdated:A,fecha:N.value},null,8,["cuenta-id","edited-item","fecha"])]),_:1},8,["modelValue"])])),(j(),K(Ve,{to:"#modal"},[t(Ie,{modelValue:W.value,"onUpdate:modelValue":l[6]||(l[6]=s=>W.value=s),persistent:"","transition-show":"jump-down","transition-hide":"jump-down"},{default:r(()=>[t(to,{cuenta:M.value,onItemsSaved:q,fecha_desde:d.fechaInicio,fecha_hasta:d.fechaFin},null,8,["cuenta","fecha_desde","fecha_hasta"])]),_:1},8,["modelValue"])]))],64))}};var aa=lt(Eo,[["__scopeId","data-v-4bbe4140"]]);export{aa as default};
