import{Q as Te,a as ue}from"./QBreadcrumbs.fcd8d044.js";import{Q as we,a as Ke,b as Ae,C as J}from"./index.804869e1.js";import{l as Ee,m as Qe,q as Ne,r as x,bk as $e,c as T,w as se,t as b,g as Ie,n as pe,bn as ze,a_ as Be,ao as ae,bv as De,$ as fe,E as M,aH as Fe,bw as be,aI as Pe,af as Le,ag as E,aK as Ve,aj as f,ai as y,aq as m,Q as Ue,ah as B,u as je,ap as le,b5 as Me,b6 as Re,b4 as ve,aM as V,aN as U,aG as he,b7 as Oe,b2 as He,b3 as Ge}from"./index.20d4ad85.js";import{b as Je,Q as W,a as j}from"./QList.5cb48b53.js";import{Q as We}from"./QSlideTransition.55653597.js";import{u as Xe,a as Ye,b as Ze}from"./CuentaContableSelect.d4102a6d.js";import{a as et,u as tt}from"./useNotificacion.79136029.js";import"./format.9422eb17.js";import"./index.27a31e1c.js";import"./DialogTitle.a45c2883.js";import"./QItemLabel.be9194dc.js";import"./printer.c268160e.js";const lt=["none","strict","leaf","leaf-filtered"];var at=Ee({name:"QTree",props:{...Qe,nodes:{type:Array,required:!0},nodeKey:{type:String,required:!0},labelKey:{type:String,default:"label"},childrenKey:{type:String,default:"children"},dense:Boolean,color:String,controlColor:String,textColor:String,selectedColor:String,icon:String,tickStrategy:{type:String,default:"none",validator:l=>lt.includes(l)},ticked:Array,expanded:Array,selected:{},noSelectionUnset:Boolean,defaultExpandAll:Boolean,accordion:Boolean,filter:String,filterMethod:Function,duration:Number,noConnectors:Boolean,noTransition:Boolean,noNodesLabel:String,noResultsLabel:String},emits:["update:expanded","update:ticked","update:selected","lazyLoad","afterShow","afterHide"],setup(l,{slots:S,emit:_}){const{proxy:A}=Ie(),{$q:w}=A,Q=Ne(l,w),K=x({}),q=x(l.ticked||[]),g=x(l.expanded||[]);let D={};$e(()=>{D={}});const F=T(()=>`q-tree q-tree--${l.dense===!0?"dense":"standard"}`+(l.noConnectors===!0?" q-tree--no-connectors":"")+(Q.value===!0?" q-tree--dark":"")+(l.color!==void 0?` text-${l.color}`:"")),P=T(()=>l.selected!==void 0),X=T(()=>l.icon||w.iconSet.tree.icon),R=T(()=>l.controlColor||l.color),N=T(()=>l.textColor!==void 0?` text-${l.textColor}`:""),O=T(()=>{const t=l.selectedColor||l.color;return t?` text-${t}`:""}),Y=T(()=>l.filterMethod!==void 0?l.filterMethod:(t,a)=>{const e=a.toLowerCase();return t[l.labelKey]&&t[l.labelKey].toLowerCase().indexOf(e)>-1}),k=T(()=>{const t={},a=(e,o)=>{const n=e.tickStrategy||(o?o.tickStrategy:l.tickStrategy),c=e[l.nodeKey],u=e[l.childrenKey]&&Array.isArray(e[l.childrenKey])&&e[l.childrenKey].length!==0,p=e.disabled!==!0&&P.value===!0&&e.selectable!==!1,h=e.disabled!==!0&&e.expandable!==!1,Se=n!=="none",G=n==="strict",de=n==="leaf-filtered",ee=n==="leaf"||n==="leaf-filtered";let te=e.disabled!==!0&&e.tickable!==!1;ee===!0&&te===!0&&o&&o.tickable!==!0&&(te=!1);let z=e.lazy;z===!0&&K.value[c]!==void 0&&Array.isArray(e[l.childrenKey])===!0&&(z=K.value[c]);const d={key:c,parent:o,isParent:u,lazy:z,disabled:e.disabled,link:e.disabled!==!0&&(p===!0||h===!0&&(u===!0||z===!0)),children:[],matchesFilter:l.filter?Y.value(e,l.filter):!0,selected:c===l.selected&&p===!0,selectable:p,expanded:u===!0?g.value.includes(c):!1,expandable:h,noTick:e.noTick===!0||G!==!0&&z&&z!=="loaded",tickable:te,tickStrategy:n,hasTicking:Se,strictTicking:G,leafFilteredTicking:de,leafTicking:ee,ticked:G===!0?q.value.includes(c):u===!0?!1:q.value.includes(c)};if(t[c]=d,u===!0&&(d.children=e[l.childrenKey].map(s=>a(s,d)),l.filter&&(d.matchesFilter!==!0?d.matchesFilter=d.children.some(s=>s.matchesFilter):d.noTick!==!0&&d.disabled!==!0&&d.tickable===!0&&de===!0&&d.children.every(s=>s.matchesFilter!==!0||s.noTick===!0||s.tickable!==!0)===!0&&(d.tickable=!1)),d.matchesFilter===!0&&(d.noTick!==!0&&G!==!0&&d.children.every(s=>s.noTick)===!0&&(d.noTick=!0),ee))){if(d.ticked=!1,d.indeterminate=d.children.some(s=>s.indeterminate===!0),d.tickable=d.tickable===!0&&d.children.some(s=>s.tickable),d.indeterminate!==!0){const s=d.children.reduce((ce,qe)=>qe.ticked===!0?ce+1:ce,0);s===d.children.length?d.ticked=!0:s>0&&(d.indeterminate=!0)}d.indeterminate===!0&&(d.indeterminateNextState=d.children.every(s=>s.tickable!==!0||s.ticked!==!0))}return d};return l.nodes.forEach(e=>a(e,null)),t});se(()=>l.ticked,t=>{q.value=t}),se(()=>l.expanded,t=>{g.value=t});function $(t){const a=[].reduce,e=(o,n)=>{if(o||!n)return o;if(Array.isArray(n)===!0)return a.call(Object(n),e,o);if(n[l.nodeKey]===t)return n;if(n[l.childrenKey])return e(null,n[l.childrenKey])};return e(null,l.nodes)}function i(){return q.value.map(t=>$(t))}function v(){return g.value.map(t=>$(t))}function r(t){return t&&k.value[t]?k.value[t].expanded:!1}function C(){l.expanded!==void 0?_("update:expanded",[]):g.value=[]}function I(){const t=[],a=e=>{e[l.childrenKey]&&e[l.childrenKey].length!==0&&e.expandable!==!1&&e.disabled!==!0&&(t.push(e[l.nodeKey]),e[l.childrenKey].forEach(a))};l.nodes.forEach(a),l.expanded!==void 0?_("update:expanded",t):g.value=t}function L(t,a,e=$(t),o=k.value[t]){if(o.lazy&&o.lazy!=="loaded"){if(o.lazy==="loading")return;K.value[t]="loading",Array.isArray(e[l.childrenKey])!==!0&&(e[l.childrenKey]=[]),_("lazyLoad",{node:e,key:t,done:n=>{K.value[t]="loaded",e[l.childrenKey]=Array.isArray(n)===!0?n:[],pe(()=>{const c=k.value[t];c&&c.isParent===!0&&ne(t,!0)})},fail:()=>{delete K.value[t],e[l.childrenKey].length===0&&delete e[l.childrenKey]}})}else o.isParent===!0&&o.expandable===!0&&ne(t,a)}function ne(t,a){let e=g.value;const o=l.expanded!==void 0;if(o===!0&&(e=e.slice()),a){if(l.accordion&&k.value[t]){const n=[];k.value[t].parent?k.value[t].parent.children.forEach(c=>{c.key!==t&&c.expandable===!0&&n.push(c.key)}):l.nodes.forEach(c=>{const u=c[l.nodeKey];u!==t&&n.push(u)}),n.length!==0&&(e=e.filter(c=>n.includes(c)===!1))}e=e.concat([t]).filter((n,c,u)=>u.indexOf(n)===c)}else e=e.filter(n=>n!==t);o===!0?_("update:expanded",e):g.value=e}function ye(t){return t&&k.value[t]?k.value[t].ticked:!1}function H(t,a){let e=q.value;const o=l.ticked!==void 0;o===!0&&(e=e.slice()),a?e=e.concat(t).filter((n,c,u)=>u.indexOf(n)===c):e=e.filter(n=>t.includes(n)===!1),o===!0&&_("update:ticked",e)}function ge(t,a,e){const o={tree:A,node:t,key:e,color:l.color,dark:Q.value};return be(o,"expanded",()=>a.expanded,n=>{n!==a.expanded&&L(e,n)}),be(o,"ticked",()=>a.ticked,n=>{n!==a.ticked&&H([e],n)}),o}function ie(t){return(l.filter?t.filter(a=>k.value[a[l.nodeKey]].matchesFilter):t).map(a=>Ce(a))}function ke(t){if(t.icon!==void 0)return b(ae,{class:"q-tree__icon q-mr-sm",name:t.icon,color:t.iconColor});const a=t.img||t.avatar;if(a)return b("img",{class:`q-tree__${t.img?"img":"avatar"} q-mr-sm`,src:a})}function _e(){_("afterShow")}function me(){_("afterHide")}function Ce(t){const a=t[l.nodeKey],e=k.value[a],o=t.header&&S[`header-${t.header}`]||S["default-header"],n=e.isParent===!0?ie(t[l.childrenKey]):[],c=n.length!==0||e.lazy&&e.lazy!=="loaded";let u=t.body&&S[`body-${t.body}`]||S["default-body"];const p=o!==void 0||u!==void 0?ge(t,e,a):null;return u!==void 0&&(u=b("div",{class:"q-tree__node-body relative-position"},[b("div",{class:N.value},[u(p)])])),b("div",{key:a,class:`q-tree__node relative-position q-tree__node--${c===!0?"parent":"child"}`},[b("div",{class:"q-tree__node-header relative-position row no-wrap items-center"+(e.link===!0?" q-tree__node--link q-hoverable q-focusable":"")+(e.selected===!0?" q-tree__node--selected":"")+(e.disabled===!0?" q-tree__node--disabled":""),tabindex:e.link===!0?0:-1,ariaExpanded:n.length>0?e.expanded:null,role:"treeitem",onClick:h=>{re(t,e,h)},onKeypress(h){ze(h)!==!0&&(h.keyCode===13?re(t,e,h,!0):h.keyCode===32&&Z(t,e,h,!0))}},[b("div",{class:"q-focus-helper",tabindex:-1,ref:h=>{D[e.key]=h}}),e.lazy==="loading"?b(Be,{class:"q-tree__spinner",color:R.value}):c===!0?b(ae,{class:"q-tree__arrow"+(e.expanded===!0?" q-tree__arrow--rotate":""),name:X.value,onClick(h){Z(t,e,h)}}):null,e.hasTicking===!0&&e.noTick!==!0?b(De,{class:"q-tree__tickbox",modelValue:e.indeterminate===!0?null:e.ticked,color:R.value,dark:Q.value,dense:!0,keepColor:!0,disable:e.tickable!==!0,onKeydown:fe,"onUpdate:modelValue":h=>{xe(e,h)}}):null,b("div",{class:"q-tree__node-header-content col row no-wrap items-center"+(e.selected===!0?O.value:N.value)},[o?o(p):[ke(t),b("div",t[l.labelKey])]])]),c===!0?l.noTransition===!0?e.expanded===!0?b("div",{class:"q-tree__node-collapsible"+N.value,key:`${a}__q`},[u,b("div",{class:"q-tree__children"+(e.disabled===!0?" q-tree__node--disabled":""),role:"group"},n)]):null:b(We,{duration:l.duration,onShow:_e,onHide:me},()=>M(b("div",{class:"q-tree__node-collapsible"+N.value,key:`${a}__q`},[u,b("div",{class:"q-tree__children"+(e.disabled===!0?" q-tree__node--disabled":""),role:"group"},n)]),[[Fe,e.expanded]])):u])}function oe(t){const a=D[t];a&&a.focus()}function re(t,a,e,o){o!==!0&&a.selectable!==!1&&oe(a.key),P.value&&a.selectable?l.noSelectionUnset===!1?_("update:selected",a.key!==l.selected?a.key:null):a.key!==l.selected&&_("update:selected",a.key===void 0?null:a.key):Z(t,a,e,o),typeof t.handler=="function"&&t.handler(t)}function Z(t,a,e,o){e!==void 0&&fe(e),o!==!0&&a.selectable!==!1&&oe(a.key),L(a.key,!a.expanded,t,a)}function xe(t,a){if(t.indeterminate===!0&&(a=t.indeterminateNextState),t.strictTicking)H([t.key],a);else if(t.leafTicking){const e=[],o=n=>{n.isParent?(a!==!0&&n.noTick!==!0&&n.tickable===!0&&e.push(n.key),n.leafTicking===!0&&n.children.forEach(o)):n.noTick!==!0&&n.tickable===!0&&(n.leafFilteredTicking!==!0||n.matchesFilter===!0)&&e.push(n.key)};o(t),H(e,a)}}return l.defaultExpandAll===!0&&I(),Object.assign(A,{getNodeByKey:$,getTickedNodes:i,getExpandedNodes:v,isExpanded:r,collapseAll:C,expandAll:I,setExpanded:L,isTicked:ye,setTicked:H}),()=>{const t=ie(l.nodes);return b("div",{class:F.value,role:"tree"},t.length===0?l.filter?l.noResultsLabel||w.lang.tree.noResults:l.noNodesLabel||w.lang.tree.noNodes:t)}}});const nt=l=>(He("data-v-2ddf125b"),l=l(),Ge(),l),it={class:"column items-center",style:{border:"0px solid red"}},ot={class:"row items-center q-ml-sm q-gutter-x-sm"},rt={class:"q-pa-md q-gutter-sm"},dt={class:"q-pl-sm"},ct={class:"row justify-between full-width"},ut=nt(()=>m("div",{class:"page-title"},"Cuentas Contables",-1)),st={class:"q-pl-md"},ft={class:"row fit",style:{border:"0px solid red"}},bt={class:"column"},vt={class:"text-primary text-caption"},ht={__name:"CuentasContablesPage",setup(l){const S=et(),_=tt();Le();const A=Xe(),w=Ye(),Q=x([]),K=x(null),q=x(""),g=x(!1),D=x({id:void 0,label:""}),F=x({id:null,nombre:null}),P=x({padre_id:null,item:null}),X=T({get(){var i;return((i=A.arbolCuentasContables)==null?void 0:i.length)>0}});function R(i){const v=i.node.subnivel,r=i.node.id.toString().substring(0,5-v),C=i.node.children?i.node.children.length:0;let I="";if(v<2&&C>0){const L=i.node.children[C-1];I=parseInt(L.id)+1}else I=r.toString();F.value={action:"add",id:I.toString(),nombre:null,padreId:i.node.id,padre:{...i.node,nombreCompleto:`${i.node.id} - ${i.node.nombre}`},subnivel:i.node.subnivel-1,tipoAfectacion:i.node.tipoAfectacion},g.value=!0}function N(i){console.log("item to edit...",i.node),F.value={...i.node,id:i.node.id.toString(),action:"edit",tipoAfectacion:i.node.tipoAfectacion,children:void 0},g.value=!0}function O(i){P.value={padre_id:i.node.padreId,item:i.node},O.value=_.dialog({title:"Confirmar",style:"width:500px",message:`Est\xE1 a punto de eliminar la cuenta contable "${i.node.label}" \xBFDesea continuar con la eliminaci\xF3n?`,ok:{push:!0,color:"positive",label:"Continuar"},cancel:{push:!0,color:"negative",flat:!0,label:"cancelar"},persistent:!0}).onOk(()=>{w.cuentaContableDelete({id:i.node.id})}).onCancel(()=>{P.value={padre_id:null,item:null}}).onDismiss(()=>{})}function Y(i){console.log("selected",i),D.value=A.findTreeElementById(i)}function k(){g.value=!1}function $(){console.log("cuentaContableUpdated()"),g.value=!1}return w.onDoneCuentaContableDelete(({data:i})=>{if(i){console.log("deleted");const v=i.cuentaContableDelete.cuentaContable;S.mostrarNotificacionPositiva(`La cuenta contable "${v.nombreCompleto}" fu\xE9 eliminada con \xE9xito.`,1200)}}),w.onErrorCuentaContableDelete(i=>{var C;const r=((C=i==null?void 0:i.toString())!=null?C:"").includes("REFERENCE constraint")?"La cuenta contable ya ha sido utilizada, no es posible eliminar":"No es posible eliminar este cuenta contable, favor de verificar.";S.mostrarNotificacionNegativa(r,1600)}),(i,v)=>(E(),Ve("div",it,[f(we,{class:"",dense:"",fit:""},{default:y(()=>[m("div",ot,[m("div",rt,[f(Te,{class:"breadcrum-component","active-color":"primary",separator:">","separator-color":"primary"},{default:y(()=>[f(ue,{icon:"home",label:"Home",to:"/"}),f(ue,{label:"Cuentas Contables",icon:"account_balance"})]),_:1})])]),f(Ke)]),_:1}),m("div",dt,[m("div",ct,[ut,m("div",st,[f(Ue,{ref:"filterRef",outlined:"",modelValue:q.value,"onUpdate:modelValue":v[0]||(v[0]=r=>q.value=r),label:"Buscar Cuenta Contable",clearable:"",dense:"",style:{width:"400px"},color:"secondary",class:"bg-accent-light"},{append:y(()=>[f(ae,{name:"filter_alt"})]),_:1},8,["modelValue"])])]),m("div",ft,[X.value?(E(),B(at,{key:0,nodes:je(A).arbolCuentasContables,"node-key":"id","label-key":"label",selected:K.value,"onUpdate:selected":[v[1]||(v[1]=r=>K.value=r),Y],expanded:Q.value,"onUpdate:expanded":v[2]||(v[2]=r=>Q.value=r),"default-expand-all":"",color:"secondary","selected-color":"accent",dense:"",style:{width:"800px"},"no-connectors":"",filter:q.value,class:"font-tree"},{"default-header":y(r=>[m("div",{class:ve({row:!0,"items-center":!0,encabezado:r.node.subnivel!=0,"full-width":!0})},[m("div",bt,[m("span",{class:ve({active:r.node.id==r.tree.selected,"text-weight-regular text-primary-dark":r.node.subnivel==0})},[V(U(r.node.label),1),m("span",vt,U(r.node.tipoAfectacion=="C"?" (Cargo)":r.node.tipoAfectacion=="A"?" (Abono)":r.node.tipoAfectacion),1)],2)]),f(Ae,{"touch-position":"","context-menu":"",class:"text-primary"},{default:y(()=>[f(Je,{style:{"min-width":"100px"}},{default:y(()=>[r.node.subnivel!=0?M((E(),B(W,{key:0,clickable:"",onClick:C=>R(r)},{default:y(()=>[f(j,null,{default:y(()=>[V('Agregar Sub-Cuenta Contable a "'+U(r.node.label)+'"',1)]),_:2},1024)]),_:2},1032,["onClick"])),[[J]]):le("",!0),M((E(),B(W,{clickable:"",onClick:C=>N(r)},{default:y(()=>[f(j,null,{default:y(()=>[V("Editar "+U(r.node.id),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[J]]),f(he),f(he),!r.node.children||r.node.children.length<=0?M((E(),B(W,{key:1,clickable:"",onClick:C=>O(r),class:"text-negative-pastel"},{default:y(()=>[f(j,{avatar:""},{default:y(()=>[f(Oe,{size:"40px","font-size":"22px",color:"negative-pastel","text-color":"white",icon:"delete"})]),_:1}),f(j,null,{default:y(()=>[V(" Eliminar "+U(r.node.id),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[J]]):le("",!0),M((E(),B(W,{clickable:""},{default:y(()=>[f(j,null,{default:y(()=>[V("Cerrar")]),_:1})]),_:1})),[[J]])]),_:2},1024)]),_:2},1024)],2)]),_:1},8,["nodes","selected","expanded","filter"])):le("",!0)])]),(E(),B(Re,{to:"#modal"},[f(Me,{modelValue:g.value,"onUpdate:modelValue":v[3]||(v[3]=r=>g.value=r),persistent:"","transition-show":"jump-up","transition-hide":"jump-down"},{default:y(()=>[f(Ze,{"edited-item":F.value,onCuentaContableSaved:k,onCuentaContableUpdated:$,"is-padre-default":!0},null,8,["edited-item"])]),_:1},8,["modelValue"])]))]))}};var At=Pe(ht,[["__scopeId","data-v-2ddf125b"]]);export{At as default};
