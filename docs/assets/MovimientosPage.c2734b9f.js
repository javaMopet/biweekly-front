import{aI as ae,r as i,c as B,w as Qe,ag as S,aK as D,aj as o,ai as a,aq as f,aN as V,Q as ie,ap as P,T as Ne,b4 as re,b2 as ye,b3 as he,f as se,H as ze,aQ as Je,aJ as Ge,al as ge,z as x,ah as R,b5 as ve,b6 as Me,aO as ne,ao as Q,E as He,I as Be,b7 as Ye,am as Xe,aM as Y,u as Ke,b8 as We,P as Ze,k as A,aP as xe}from"./index.20d4ad85.js";import{Q as De,D as eo}from"./DialogTitle.a45c2883.js";import{u as oo,Q as H,a as j}from"./useCuentasCrud.5ef3cef5.js";import{Q as ao,a as ke}from"./CategoriaSelect.674cba46.js";import{f as to,Q as lo,C as ro,a as T,_ as no,M as io}from"./FormRegistroCategoria.298f8369.js";import{r as so,u as uo,s as co}from"./index.27a31e1c.js";import{a as Re,u as Ue}from"./useNotificacion.79136029.js";import{u as Ae,D as Pe}from"./useFormato.c7e3ed92.js";import{C as mo,Q as po,a as fo}from"./index.804869e1.js";import{Q as Fe}from"./QTooltip.a2dbcdc4.js";import{u as vo,L as go,_ as _o}from"./FormCuentaRegistro.7f001ac3.js";import"./QBtnToggle.bfaab28d.js";import"./QList.5cb48b53.js";import"./CuentaContableSelect.d4102a6d.js";import"./QImg.df9e647c.js";import"./QItemLabel.be9194dc.js";import{_ as bo}from"./FormRegistroCuenta.fba7adc4.js";import"./format.9422eb17.js";import"./printer.c268160e.js";import"./TouchPan.b5696d76.js";import"./QResizeObserver.86d26826.js";const yo={props:{modelValue:{type:String,default:""},debug:{type:Boolean,default:!1},readonly:{type:Boolean,required:!1,default:!1},autofocus:{type:Boolean,required:!1,default:!1},label:{type:String,required:!1,default:"Precio"},rules:{type:Array,required:!1,default:()=>[]},manualValidation:{type:Boolean,required:!1,default:!1}},emits:["update:modelValue","blur"],mounted(){console.log("mounted",this.modelValue),this.inputValue=this.modelValue},watch:{modelValue(l){this.inputValue=l}},setup(l,{emit:v}){const d=i({}),n=i(!1),b=i(0);i();const h=i(!1),y=B({get(){return n.value?l.modelValue:to(l.modelValue)},set(E){b.value=E,v("update:modelValue",E)}}),q=B({get(){return d.value.code}});Qe(()=>l.manualValidation,(E,_)=>{console.log("CAMBIANDO validacion manual",_,E)});var m={EUR:{name:"Euro",symbol:"\u20AC",symbolNative:"\u20AC",code:"EUR",decimalPlaces:2},GBP:{name:"Pound Sterling",symbol:"\xA3",symbolNative:"\xA3",code:"GBP",decimalPlaces:2,exchangeRate:.895},USD:{name:"US Dollar",symbol:"US$",symbolNative:"$",code:"USD",decimalPlaces:2,exchangeRate:1.185},MNX:{name:"Peso mx",symbol:"MNX$",symbolNative:"$",code:"MNX",decimalPlaces:2},CAD:{name:"Canadian Dollar",symbol:"CA$",symbolNative:"$",code:"CAD",decimalPlaces:2,exchangeRate:1.501}};const u=i(Object.assign({},m));function g(E){n.value=!1,v("blur"),l.manualValidation&&F()}function w(){n.value=!0}const F=()=>(console.log("validando el precio",y.value),y.value==="$0.00"?(h.value=!0,setTimeout(()=>{h.value=!1},2500),!1):(h.value=!1,!0));function N(E){d.value=u.value[E]||{}}return{inputValue:y,containsError:h,editingLabel:q,selectedCurrency:d,setCurrency:N,onFocus:w,onBlur:g,validar:F}}},ho=l=>(ye("data-v-b66fa3aa"),l=l(),he(),l),So={class:"text-subtitle1"},Io={key:0,class:"level2"},wo=ho(()=>f("div",{class:"level1"},[f("div",{class:"price-error"},"Precio distinto de 0")],-1)),Co=[wo];function qo(l,v,d,n,b,h){return S(),D("div",{style:{"z-index":"5"},class:re([n.containsError?"input-error":"input-noError"])},[o(ie,{modelValue:n.inputValue,"onUpdate:modelValue":v[0]||(v[0]=y=>n.inputValue=y),type:"text",onBlur:n.onBlur,onFocus:n.onFocus,"input-class":"text-right",placeholder:"0.00",ref:"inputEditing",outlined:"",color:"secondary",dense:"",label:d.label,readonly:d.readonly,autofocus:d.autofocus,"lazy-rules":"",rules:d.rules},{append:a(()=>[f("div",So,V(n.editingLabel),1)]),_:1},8,["modelValue","onBlur","onFocus","label","readonly","autofocus","rules"]),o(Ne,{name:"fade"},{default:a(()=>[n.containsError?(S(),D("div",Io,Co)):P("",!0)]),_:1})],2)}var Vo=ae(yo,[["render",qo],["__scopeId","data-v-b66fa3aa"]]);const Le={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",TOP_CENTER:"top-center",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",BOTTOM_CENTER:"bottom-center"},_e={LIGHT:"light",DARK:"dark",COLORED:"colored",AUTO:"auto"},Te={INFO:"info",SUCCESS:"success",WARNING:"warning",ERROR:"error",DEFAULT:"default"},$e={dangerouslyHTMLString:!1,multiple:!0,position:Le.TOP_RIGHT,autoClose:5e3,transition:"bounce",hideProgressBar:!1,pauseOnHover:!0,pauseOnFocusLoss:!0,closeOnClick:!0,className:"",bodyClassName:"",style:{},progressClassName:"",progressStyle:{},role:"alert",theme:"light"},Oo={rtl:!1,newestOnTop:!1,toastClassName:""},Eo={...$e,...Oo};({...$e,type:Te.DEFAULT});var be=(l=>(l[l.COLLAPSE_DURATION=300]="COLLAPSE_DURATION",l[l.DEBOUNCE_DURATION=50]="DEBOUNCE_DURATION",l.CSS_NAMESPACE="Toastify",l))(be||{});se({});se({});se({items:[]});const Fo=se({});se({});function No(...l){return Je(...l)}function Do(l={}){Fo["".concat(be.CSS_NAMESPACE,"-default-options")]=l}Le.TOP_LEFT,_e.AUTO,Te.DEFAULT;Te.DEFAULT,_e.AUTO;_e.AUTO,_e.LIGHT;const To={install(l,v={}){xo(v)}};typeof window<"u"&&(window.Vue3Toastify=To);function xo(l={}){const v=No(Eo,l);Do(v)}const ko={props:{modelValue:{type:Object,required:!1,default:()=>null},filterArray:{type:Array,required:!1,default:()=>["1","2","3"]},filterIdArray:{type:Array,required:!1,default:()=>[]},opcional:{type:Boolean,required:!1,default:!1},label:{type:String,required:!1,default:"Cuenta Bancaria"},hint:{type:String,required:!1},agregar:{type:Boolean,required:!1,default:!1},readonly:{type:Boolean,required:!1,default:!1},isValid:{type:Boolean,required:!1,default:!0},rules:{type:Array,required:!1,default:()=>[]},style:{type:String,required:!1,default:""},disable:{type:Boolean,required:!1,default:!1}},emits:["update:modelValue"],setup(l,{emit:v}){const d=oo(),n=i([]),b=i(!1),h=i(!1),y=B({get(){return l.modelValue},set(g){v("update:modelValue",g)}}),q=B({get(){var g,w;return(w=(g=d.listaCuentas)==null?void 0:g.filter(F=>l.filterArray.includes(F.tipoCuenta.id)).filter(F=>!l.filterIdArray.includes(F.id)))!=null?w:[]}});function m(g,w){if(g===""){w(()=>{n.value=q.value});return}w(()=>{const F=g.toLowerCase();n.value=q.value.filter(N=>N.nombre.toLowerCase().indexOf(F)>-1)})}return{cuenta:y,form_cuenta_show:b,filteredOptions:n,containsError:h,filterFn:m,validar:()=>{var g;return console.log("validando la cuenta",y.value),(g=y.value)!=null&&g.id?(h.value=!1,!0):(h.value=!0,setTimeout(()=>{h.value=!1},2500),!1)}}},components:{FormRegistroCuenta:bo}},Mo=l=>(ye("data-v-2d3c6cf4"),l=l(),he(),l),Bo={class:"col"},Ro={key:0,class:"level2"},Uo=Mo(()=>f("div",{class:"level1"},[f("div",{class:"price-error"},"Campo requerido. Favor seleccionar.")],-1)),Ao=[Uo],Po={key:0,class:"q-mt-xs",style:{border:"0px solid red"}};function Lo(l,v,d,n,b,h){const y=Ge("FormRegistroCuenta");return S(),D(ne,null,[f("div",Bo,[o(De,{outlined:"",color:"positive",modelValue:n.cuenta,"onUpdate:modelValue":v[0]||(v[0]=q=>n.cuenta=q),options:n.filteredOptions,"option-label":"nombre",label:d.label,"use-input":"","fill-input":"","hide-selected":"","input-debounce":"0",onFilter:n.filterFn,behavior:"menu",clearable:"","lazy-rules":"",rules:d.rules,dense:"",readonly:d.readonly,style:ge(d.style),disable:d.disable},null,8,["modelValue","options","label","onFilter","rules","readonly","style","disable"]),o(Ne,{name:"fade"},{default:a(()=>[n.containsError?(S(),D("div",Ro,Ao)):P("",!0)]),_:1})]),d.agregar?(S(),D("div",Po,[o(x,{color:"accent",outline:"",icon:"add",dense:"",onClick:l.registrarCuenta},null,8,["onClick"])])):P("",!0),(S(),R(Me,{to:"#modal"},[o(ve,{modelValue:n.form_cuenta_show,"onUpdate:modelValue":v[1]||(v[1]=q=>n.form_cuenta_show=q),persistent:"","transition-show":"jump-up","transition-hide":"jump-down"},{default:a(()=>[o(y,{onCuentaSaved:l.cuentaSaved,onCuentaUpdated:l.cuentaUpdated},null,8,["onCuentaSaved","onCuentaUpdated"])]),_:1},8,["modelValue"])]))],64)}var $o=ae(ko,[["render",Lo],["__scopeId","data-v-2d3c6cf4"]]);const jo={props:{modelValue:{type:String,default:null,required:!0},lbl_field:{type:String,required:!1,default:"Fecha"},optional:{type:Boolean,required:!1,default:!0},rangoFechaInicio:{type:String,required:!1,default:""},rangoFechaFin:{type:String,required:!1,default:""},readonly:{type:Boolean,required:!1,default:!1},autofocus:{type:Boolean,required:!1,default:!1},rules:{type:Array,required:!1,default:()=>[]}},emits:["update:modelValue"],setup(l,{emit:v}){const d=i(),n=i(null),b=i(!1),h=B({get(){return l.modelValue},set(u){v("update:modelValue",u)}});function y(u,g,w){console.log("seleccionado",u,g,w),n.value.hide(),u||(h.value="")}function q(u){return!!l.rangoFechaInicio&&!!l.rangoFechaFin?u>=l.rangoFechaInicio&&u<=l.rangoFechaFin:!0}return{valor_fecha:h,events:d,popUpDate:n,containsError:b,dateSelected:y,optionsFn:q,validar:()=>(console.log("validando la fecha",h.value),h.value?(b.value=!1,!0):(b.value=!0,setTimeout(()=>{b.value=!1},2500),!1))}}},Qo=l=>(ye("data-v-520356aa"),l=l(),he(),l),zo={class:"row items-center justify-end"},Jo={key:0,class:"level2"},Go=Qo(()=>f("div",{class:"level1"},[f("div",{class:"price-error"},"Requerido.")],-1)),Ho=[Go];function Yo(l,v,d,n,b,h){return S(),D(ne,null,[o(ie,{modelValue:n.valor_fecha,"onUpdate:modelValue":v[1]||(v[1]=y=>n.valor_fecha=y),dense:"",outlined:"",color:"secondary",label:d.lbl_field,"lazy-rules":"",rules:d.rules,readonly:d.readonly,autofocus:d.autofocus},{append:a(()=>[o(Q,{name:"event",class:"cursor-pointer"},{default:a(()=>[o(lo,{cover:"","transition-show":"scale","transition-hide":"scale",ref:"popUpDate"},{default:a(()=>[o(ao,{modelValue:n.valor_fecha,"onUpdate:modelValue":[v[0]||(v[0]=y=>n.valor_fecha=y),n.dateSelected],events:n.events,dense:"",mask:"DD/MM/YYYY",options:n.optionsFn,readonly:d.readonly},{default:a(()=>[f("div",zo,[He(o(x,{label:"Hecho",color:"primary",flat:""},null,512),[[mo]])])]),_:1},8,["modelValue","events","onUpdate:modelValue","options","readonly"])]),_:1},512)]),_:1})]),_:1},8,["modelValue","label","rules","readonly","autofocus"]),o(Ne,{name:"fade"},{default:a(()=>[n.containsError?(S(),D("div",Jo,Ho)):P("",!0)]),_:1})],64)}var Xo=ae(jo,[["render",Yo],["__scopeId","data-v-520356aa"]]);const je=l=>(ye("data-v-ddf8261c"),l=l(),he(),l),Ko={class:"my-card bg-main-background",style:{width:"1200px","min-width":"1200px",overflow:"hidden"}},Wo={class:"row items-center",style:{border:"0px solid red"}},Zo={class:"dialog__title--name"},ea={class:"main-content q-py-lg"},oa={class:"cuenta-content"},aa={class:"row q-gutter-md text-primary"},ta=je(()=>f("span",{class:""},"Periodo:",-1)),la={class:"tarjeta__resumen-valor text-bold"},ra={style:{"max-height":"65vh",height:"65vh",border:"0px solid red"},class:"scroll"},na={key:0,class:"row q-gutter-x-md items-center actualizando-class"},ia={class:"row justify-start"},sa={class:"row q-pl-lg q-gutter-x-md"},da=je(()=>f("span",{class:"text-condensed text-primary"}," Importe total registros:",-1)),ua={class:"text-bold"},ca={__name:"ListaMovimientos",props:{cellData:{type:Object,required:!0,default:()=>({})}},emits:["registroCreated","registroUpdated","registroDeleted"],setup(l,{emit:v}){const d=Ae(),n=vo(),{mostrarNotificacionPositiva:b,mostrarNotificacionNegativa:h,mostrarNotificacionInformativa:y}=Re(),q=Ue();i(null);const m=i({}),u=i(null),g=i(null),w=i(null),F=i([]),N=i([]);i([]);const E={fecha:"",importe:"",cuenta:null,observaciones:""},_=i({...E});i({isPriceError:!1});const k=i([]),C=i(null),M=l,L=v;Be(()=>{$()});const de=[{name:"fecha",label:"Fecha",field:"fecha",format:t=>Pe.fromISO(t).toFormat("dd-MM-yyyy"),sortable:!1,align:"center",headerStyle:"width:13%"},{name:"importe",label:"Importe",field:t=>t.importe,format:(t,s)=>`${te(t)}`,sortable:!1,align:"right",headerStyle:"width:15%;max-width:15%;min-width:15%"},{name:"cuenta",label:"Cuenta",field:t=>{var s;return((s=t.cuenta)==null?void 0:s.nombre)||""},sortable:!1,align:"left",headerStyle:"width: 30%;max-width:30%;min-width:30%"},{name:"observaciones",label:"Observaciones",field:t=>t.observaciones,sortable:!1,align:"left",style:"text-wrap: wrap; min-width:40%;max-width:40%",headerStyle:"width:32%",style:"text-wrap: wrap"},{name:"acciones",label:"Acciones",field:"",sortable:!1,align:"center",headerStyle:"width: 8%;text-wrap: wrap",style:"text-wrap: wrap"}];function X(t){const s=t.rowIndex,c=t.row;C.value={rowIndex:s,row:c},console.log(c.categoria.tipoMovimientoId);const O=c.categoria.tipoMovimientoId==="2"?parseFloat(c.importe)*-1:parseFloat(c.importe),oe=d.convertDateFromIsoToInput(c.fecha);_.value={fecha:oe,importe:O.toString(),cuenta:c.cuenta,observaciones:c.observaciones},console.log("estableciendo formItem",_.value)}function K(){C.value=null,_.value={...E},W()}function $(){var s,c;_.value={...E},W();let t=(c=(s=m.value.importeDefault)==null?void 0:s.toString())!=null?c:"";t=t===0||t==="0"?"":t,_.value.importe=t,_.value.cuenta=m.value.cuentaDefault,_.value.observaciones=m.value.descripcion}function z(){console.log("Eliminacion...."),console.dir(k.value),console.table(k.value);const t=`Va a eliminar permanentemente ${k.value.length} registros. \xBFEst\xE1 seguro que desea continuar con la eliminaci\xF3n?`;q.dialog({title:"Confirmar",style:"width:500px",message:t,ok:{push:!0,color:"positive",label:"Continuar"},cancel:{push:!0,color:"negative",flat:!0,label:"cancelar"},persistent:!0}).onOk(()=>{U()}).onCancel(()=>{}).onDismiss(()=>{})}function U(){const t=k.value.map(s=>s.id);console.log(t.toString()),n.registrosDelete({ids:t.toString()})}n.onErrorRegistrosDelete(t=>{console.trace(t)}),n.onDoneRegistrosDelete(({data:t})=>{console.log("data",t),b("los registros se eliminaron correctamente"),k.value=[],pe(),L("registroDeleted",t.registrosDelete.cuentasIds)});function W(){console.log("fecha_inicio",M.cellData.fecha_inicio),_.value.fecha=d.convertDateFromIsoToInput(M.cellData.fecha_inicio)}function Z(){var t,s;if(J()){if(["1","2"].includes(m.value.tipoMovimiento.id)){const c=m.value.tipoMovimiento.id==="1"?"A":"C",O=c==="C"?parseFloat(_.value.importe)*-1:parseFloat(_.value.importe),oe={id:(s=(t=C.value)==null?void 0:t.row.id)!=null?s:void 0,categoriaId:m.value.id,estadoRegistroId:2,tipoAfectacion:c,cuentaId:parseInt(_.value.cuenta.id),importe:O,fecha:d.convertDateFromInputToIso(_.value.fecha),observaciones:_.value.observaciones,userId:Ze.getItem("user").id};if(C.value){const fe=C.value.row.id;console.dir(fe),n.registroUpdate({id:fe,input:oe})}else n.createRegistro({input:oe})}}else console.log("Existen errores de validacion")}const J=()=>{const t=u.value.validar();console.log("despues de validar date",t);const s=g.value.validar();console.log("despues de validar",s);const c=w.value.validar();return console.log("despues de validar Cuenta",c),t&&s&&c};n.onDoneRegistroCreate(({data:t})=>{console.log("data",t);const s=t.registroCreate.registro;ue("Ingreso",s)}),n.onDoneRegistroUpdate(({data:t})=>{console.log("data",t),t.registroUpdate.registro,ce("Ingreso")});function ue(t,s){console.log("item saved"),N.value.push(s),b("El registro se guardado correctamente.",1500),L("registroCreated",s),$()}function ce(t){b("El registro se actualiz\xF3 correctamente.",1500),pe(),L("registroUpdated",t),C.value=null,$()}n.onErrorRegistroCreate(t=>{var s,c;console.trace(t),console.log("error",t.graphQLErrors[0]),console.log("error",(s=t.graphQLErrors[0])==null?void 0:s.extensions),console.table("error",(c=t.graphQLErrors[0])==null?void 0:c.extensions.problems)});function te(t){return d.toCurrency(parseFloat(m.value.tipoMovimiento.id==="2"?t*-1:t))}const me=i({fetchPolicy:"network-only"}),{onError:Se,onResult:Ie}=so(ro,{id:M.cellData.categoriaId},me),{onError:we,onResult:Ce,load:qe,refetch:pe}=uo(go,{cuentaId:null,categoriaId:M.cellData.categoriaId,fechaInicio:M.cellData.fecha_inicio,fechaFin:M.cellData.fecha_fin},me);Ce(({data:t})=>{console.log("data registros",t.obtenerRegistros),t.obtenerRegistros.length>0?(N.value=JSON.parse(JSON.stringify(t.obtenerRegistros)),N.value.forEach(s=>{s.importe=s.importe.toString(),s.saved=!0})):N.value.length=0}),Ie(({data:t})=>{m.value=t.categoriaById,console.dir(m.value),Ee(),$()}),we(t=>{console.error("error",t)}),Se(t=>{console.error("error",t)});const le=B({get(){return`Del: ${d.convertDateFromIsoToInput(M.cellData.fecha_inicio)} Al: ${d.convertDateFromIsoToInput(M.cellData.fecha_fin)}`}});B({get(){return F.value.length>0}});const ee=B({get(){return!!C.value}}),Ve=B({get(){return k.value.length>0}}),Oe=B({get(){return N.value.reduce((t,s)=>t+parseFloat(m.value.tipoMovimiento.id==="2"?s.importe*-1:s.importe),0)}});function Ee(){qe()}return(t,s)=>(S(),D("div",Ko,[o(eo,null,{default:a(()=>[f("div",Wo,[o(Ye,{size:"38px","font-size":"23px","text-color":"white",icon:m.value.icono,style:ge(`background-color: ${m.value.color} !important`)},null,8,["icon","style"]),f("div",Zo,V(m.value.nombre),1)])]),_:1}),f("div",ea,[f("div",oa,[o(Xe,null,{default:a(()=>[f("div",aa,[ta,f("span",la,V(le.value),1)])]),_:1}),f("div",ra,[o(j,{rows:N.value,columns:de,"row-key":"id","rows-per-page-options":[0],"hide-pagination":"",dense:"",bordered:"",class:"my-sticky-header-table",separator:"horizontal",selection:"multiple",selected:k.value,"onUpdate:selected":s[4]||(s[4]=c=>k.value=c),"no-data-label":"No hay registros para esta categoria y periodo"},{top:a(()=>[o(T,{class:"full-width"},{default:a(()=>[o(po,null,{default:a(()=>[o(x,{"no-caps":"",icon:"las la-trash-alt",color:"negative-pastel",label:"Eliminar",onClick:z,disable:!Ve.value,dense:""},null,8,["disable"]),o(fo),ee.value?(S(),D("div",na,[f("span",{class:re({"bg-accent-light":ee.value,"actualizando-class":!0})}," Actualizando ...",2),o(x,{color:"negative-pastel",icon:"las la-ban","no-caps":"",label:"Cancelar",onClick:K,dense:""})])):P("",!0)]),_:1})]),_:1})]),"header-cell-fecha":a(c=>[o(H,{props:c,class:"bg-white"},{default:a(()=>[o(Xo,{modelValue:_.value.fecha,"onUpdate:modelValue":s[0]||(s[0]=O=>_.value.fecha=O),lbl_field:"Fecha",optional:!1,"rango-fecha-inicio":m.value.fecha_inicio_formato,"rango-fecha-fin":m.value.fecha_fin_formato,ref_key:"inputDate",ref:u},null,8,["modelValue","rango-fecha-inicio","rango-fecha-fin"])]),_:2},1032,["props"])]),"header-cell-importe":a(c=>[o(H,{props:c},{default:a(()=>[o(Vo,{modelValue:_.value.importe,"onUpdate:modelValue":s[1]||(s[1]=O=>_.value.importe=O),autofocus:!0,ref_key:"inputPrecio",ref:g},null,8,["modelValue"])]),_:2},1032,["props"])]),"header-cell-cuenta":a(c=>[o(H,{props:c},{default:a(()=>[o($o,{modelValue:_.value.cuenta,"onUpdate:modelValue":s[2]||(s[2]=O=>_.value.cuenta=O),agregar:!1,"filter-array":["1","2"],ref_key:"selectCuenta",ref:w},null,8,["modelValue"])]),_:2},1032,["props"])]),"header-cell-observaciones":a(c=>[o(H,{props:c},{default:a(()=>[o(ie,{modelValue:_.value.observaciones,"onUpdate:modelValue":s[3]||(s[3]=O=>_.value.observaciones=O),type:"textarea",label:"observaciones",dense:"",outlined:"",color:"secondary",rows:"1","lazy-rules":""},null,8,["modelValue"])]),_:2},1032,["props"])]),"header-cell-acciones":a(c=>[o(H,{props:c},{default:a(()=>[f("div",ia,[C.value?(S(),R(x,{key:1,class:"button-save",icon:"save",onClick:Z,flat:""},{default:a(()=>[o(Fe,{offset:[10,10]},{default:a(()=>[Y(" Actualizar ")]),_:1})]),_:1})):(S(),R(x,{key:0,color:"primary",label:"Agregar",onClick:Z,"no-caps":"",rounded:"",dense:""})),C.value?(S(),R(x,{key:2,class:"button-cancel",icon:"las la-ban",onClick:O=>K(c),flat:""},{default:a(()=>[o(Fe,{offset:[10,10]},{default:a(()=>[Y(" Cancelar ")]),_:1})]),_:2},1032,["onClick"])):P("",!0)])]),_:2},1032,["props"])]),"body-cell-acciones":a(c=>[o(T,{props:c},{default:a(()=>[o(x,{disable:ee.value,class:"button-edit",onClick:O=>X(c),icon:"las la-edit","no-caps":"",dense:"",flat:""},{default:a(()=>[ee.value?P("",!0):(S(),R(Fe,{key:0,offset:[10,10],"transition-duration":"900"},{default:a(()=>[Y(" Editar ")]),_:1}))]),_:2},1032,["disable","onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","selected"])]),o(We,{vertical:""},{default:a(()=>[f("div",sa,[da,f("span",ua,V(Ke(d).toCurrency(Oe.value)),1)])]),_:1})])])]))}};var ma=ae(ca,[["__scopeId","data-v-ddf8261c"]]);const pa={class:"row component__bordered"},fa={__name:"MesSelect",props:{modelValue:{type:Object,required:!0,defalt:null}},emits:["update:modelValue"],setup(l,{emit:v}){const d=l,n=v,b=B({get(){return d.modelValue},set(u){n("update:modelValue",u)}});function h(u){n("update:modelValue",u)}function y(){const u=b.value.id-1;u&&(b.value=m.value.find(g=>g.id===u))}function q(){const u=b.value.id+1;!!u&&u<13&&(b.value=m.value.find(g=>g.id===u))}const m=i([{id:1,nombre:"Enero"},{id:2,nombre:"Febrero"},{id:3,nombre:"Marzo"},{id:4,nombre:"Abril"},{id:5,nombre:"Mayo"},{id:6,nombre:"Junio"},{id:7,nombre:"Julio"},{id:8,nombre:"Agosto"},{id:9,nombre:"Septiembre"},{id:10,nombre:"Octubre"},{id:11,nombre:"Noviembre"},{id:12,nombre:"Diciembre"}]);return(u,g)=>(S(),D("div",pa,[o(De,{modelValue:b.value,"onUpdate:modelValue":[g[0]||(g[0]=w=>b.value=w),h],options:m.value,"option-label":"nombre",label:"Mes",dense:"",borderless:"",color:"secondary","label-color":"dark","use-input":"","hide-selected":"","fill-input":"",style:{width:"200px"},"hide-dropdown-icon":""},{before:a(()=>[o(x,{color:"primary",round:"",icon:"arrow_left",onClick:y,dense:"",flat:""})]),prepend:a(()=>[o(Q,{name:"calendar_month"})]),after:a(()=>[o(x,{color:"primary",round:"",icon:"arrow_right",dense:"",flat:"",onClick:q})]),_:1},8,["modelValue","options"])]))}};var va=ae(fa,[["__scopeId","data-v-234ba7be"]]);const ga={class:"row inline q-gutter-x-md items-center"},_a={class:"row"},ba={class:"row items-center"},ya={class:"q-pl-sm movimientos__columna-categoria"},ha={class:"movimientos__celda--importe"},Sa={class:"q-pl-sm movimientos__columna-categoria"},Ia={class:"movimientos__celda--importe"},wa={class:"q-pl-sm movimientos__columna-categoria"},Ca={class:"cuentas__celda--importe"},qa={class:""},Va={__name:"MovimientosPage",setup(l){const v=Re();Ue();const d=Ae(),n={id:null,nombre:null,icono:"insert_emoticon",descripcion:null,color:"#019A9D",tipoMovimiento:null,tipoMovimientoId:"1",cuentaContable:null},b={categoria:null,cuenta:null,registro:{estadoRegistroId:2,importe:"",fecha:"",date:d.formatoFecha(new Date)},observaciones:""},h=i({rowsPerPage:0}),y=i([{id:1,nombre:"Enero"},{id:2,nombre:"Febrero"},{id:3,nombre:"Marzo"},{id:4,nombre:"Abril"},{id:5,nombre:"Mayo"},{id:6,nombre:"Junio"},{id:7,nombre:"Julio"},{id:8,nombre:"Agosto"},{id:9,nombre:"Septiembre"},{id:10,nombre:"Octubre"},{id:11,nombre:"Noviembre"},{id:12,nombre:"Diciembre"}]),q=i([2021,2022,2023]),m=i(y.value[0]),u=i(2023),g=i([]),w=i([]),F=i([]),N=i([]),E=i([]),_=i([]),k=i([]),C=i(),M=i({...b}),L=i(null),de=i(null),X=i(!1),K=i(!1),$=i({}),z=i([]),U=i([]),W=i(!1),Z=i();Be(()=>{const r=Pe.now();u.value=r.year;const p=r.month,e=y.value.find(I=>I.id===p);m.value=e,te(u.value,m.value.id),J()});function J(){me(),Se(),Ie(),we(),Ce()}function ue(r){const p={...r.row},e={...r.col};console.log("row",p),$.value={categoriaId:p.categoria_id,nombre_categoria:p.nombre_categoria,tipo_movimiento_id:p.tipo_movimiento_id.toString(),icono:p.icono,fecha_inicio:e.fecha_inicio,fecha_fin:e.fecha_fin,fecha_inicio_formato:d.toFormatoInputDateFromISO(e.fecha_inicio),fecha_fin_formato:d.toFormatoInputDateFromISO(e.fecha_fin),periodo_id:e.periodo_id,label:e.label},$.value.periodo_id&&(K.value=!0)}function ce(r){console.log("Agregando nueva categoria",r),console.log("tipoMovimientoId",r),Z.value={...n,tipoMovimientoId:r},console.dir("editeditem",Z.value),L.value=null,W.value=!0}function te(r,p){A.get("/columnas",{params:{ejercicio_fiscal:r,mes:p,is_saldos:0}}).then(({data:e})=>{z.value=JSON.parse(JSON.stringify(e.data)),z.value.forEach(I=>{I.name!="nombre_categoria"&&(I.format=G=>G?`${d.toCurrency(G)}`:"")})}).catch(e=>{console.log("error",e)}),A.get("/columnas",{params:{ejercicio_fiscal:r,mes:p,is_saldos:1}}).then(({data:e})=>{U.value=JSON.parse(JSON.stringify(e.data)),U.value.forEach(I=>{I.name!="nombre_categoria"&&(I.format=G=>G?`${d.toCurrency(G)}`:"")}),console.table(U)}).catch(e=>{console.log("error",e)})}function me(){A.get("/movimientos",{params:{ejercicioFiscalId:u.value,tipoMovimientoId:2,isSaldos:0}}).then(({data:r})=>{g.value=JSON.parse(JSON.stringify(r.data))}).catch(r=>{console.log("error",r)}),A.get("/movimientos",{params:{tipoMovimientoId:1,isSaldos:0,ejercicioFiscalId:u.value}}).then(({data:r})=>{w.value=JSON.parse(JSON.stringify(r.data))}).catch(r=>{console.log("error",r)})}function Se(){A.get("/movimientos",{params:{tipoMovimientoId:1,isSaldos:1,ejercicioFiscalId:u.value}}).then(({data:r})=>{F.value=JSON.parse(JSON.stringify(r.data))}).catch(r=>{console.log("error",r)}),A.get("/movimientos",{params:{tipoMovimientoId:2,isSaldos:1,ejercicioFiscalId:u.value}}).then(({data:r})=>{N.value=JSON.parse(JSON.stringify(r.data))}).catch(r=>{console.log("error",r)})}function Ie(){A.get("/saldos_movimientos",{params:{ejercicioFiscalId:u.value,mesId:m.value.id,isSaldos:0}}).then(({data:r})=>{k.value=JSON.parse(JSON.stringify(r.data))}).catch(r=>{console.log("error",r)})}function we(){A.get("/saldos_cuentas",{params:{ejercicioFiscalId:u.value,mesId:m.value.id,isSaldos:0}}).then(({data:r})=>{E.value=JSON.parse(JSON.stringify(r.data))}).catch(r=>{console.log("error",r)})}function Ce(){A.get("/saldos_finales",{params:{ejercicioFiscalId:u.value,mesId:m.value.id,isSaldos:0}}).then(({data:r})=>{_.value=JSON.parse(JSON.stringify(r.data))}).catch(r=>{console.log("error",r)})}function qe(r){X.value=!1,g.value.push(r),le("guard\xF3",r)}function pe(r){X.value=!1,le("actualiz\xF3",r),g.value[L.value]=r,M.value={...b},L.value=null}function le(r,p){v.mostrarNotificacionPositiva(`La movimiento "${p.nombre}" se ${r} correctamente`,2500)}function ee(r){console.log("El registro fue creado",r),J()}function Ve(r){J()}function Oe(r){J()}function Ee(r){te(u.value,r.id)}function t(r){console.dir(m.value),m.value=y.value[0],J(),te(u.value,m.value.id)}function s(){}function c(){}const{mutate:O,onDone:oe,onError:fe}=co(io);return oe(({data:r})=>{if(r){console.log("item deleted ",r);const p=r.movimientoDelete.movimiento;g.value.splice(de.value,1),de.value=null,le("elmin\xF3",p)}}),fe(r=>{console.error(r)}),(r,p)=>(S(),D(ne,null,[o(j,{dense:"",rows:w.value,columns:z.value,"row-key":"id",filter:C.value,"rows-per-page-options":[0],separator:"none",class:re({"my-sticky-header-table-ingreso":w.value.length>4}),"hide-bottom":"","hide-pagination":""},{"top-left":a(()=>[f("div",ga,[o(De,{modelValue:u.value,"onUpdate:modelValue":[p[0]||(p[0]=e=>u.value=e),t],options:q.value,"option-label":"nombre",label:"A\xF1o",dense:"",outlined:"",color:"secondary","label-color":"dark"},{prepend:a(()=>[o(Q,{name:"calendar_month"})]),_:1},8,["modelValue","options"]),o(va,{modelValue:m.value,"onUpdate:modelValue":[p[1]||(p[1]=e=>m.value=e),Ee]},null,8,["modelValue"])])]),"top-right":a(()=>[f("div",_a,[o(ie,{outlined:"",dense:"",debounce:"400",modelValue:C.value,"onUpdate:modelValue":p[2]||(p[2]=e=>C.value=e),placeholder:"Buscar Ingreso",class:"bg-accent-light"},{append:a(()=>[o(Q,{name:"search"})]),_:1},8,["modelValue"])])]),header:a(e=>[o(ke,{props:e},{default:a(()=>[(S(!0),D(ne,null,xe(e.cols,I=>(S(),R(H,{class:"q-gutter-x-md table__header",key:I.name,props:e},{default:a(()=>[f("span",null,V(I.periodo_id===0?"INGRESOS":I.label),1),I.periodo_id===0?(S(),R(x,{key:0,class:"button-new",label:"Nuevo",color:"traspaso-button",icon:"add_circle",dense:"",onClick:p[3]||(p[3]=G=>ce("1"))})):P("",!0)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"body-cell-nombre_categoria":a(e=>[o(T,{dense:"",props:e,class:"text-primary",style:ge(`border-left: 6px solid ${e.row.color}`)},{default:a(()=>[f("div",ba,[o(Q,{name:e.row.icono,size:"22px",color:"categoria-icon"},null,8,["name"]),f("span",ya,V(e.value),1)])]),_:2},1032,["props","style"])]),"body-cell":a(e=>[o(T,{dense:"",props:e,clickable:"",onClick:I=>ue(e)},{default:a(()=>[f("span",ha,V(e.value),1)]),_:2},1032,["props","onClick"])]),_:1},8,["rows","columns","filter","class"]),o(j,{rows:F.value,columns:U.value,"row-key":"name","hide-header":"","hide-bottom":"",separator:"none",dense:"","table-class":"bg-table-summary"},{"body-cell":a(e=>[o(T,{props:e},{default:a(()=>[Y(V(e.value),1)]),_:2},1032,["props"])]),_:1},8,["rows","columns"]),o(j,{class:"my-sticky-header-table","rows-per-page-options":[0],dense:"",rows:g.value,columns:z.value,"row-key":"id",filter:C.value,separator:"none","hide-botton":"","hide-pagination":""},{"top-left":a(()=>[]),"top-right":a(()=>[o(ie,{outlined:"",dense:"",debounce:"300",modelValue:C.value,"onUpdate:modelValue":p[4]||(p[4]=e=>C.value=e),placeholder:"Buscar Gasto",class:"bg-accent-light"},{append:a(()=>[o(Q,{name:"search"})]),_:1},8,["modelValue"])]),header:a(e=>[o(ke,{props:e},{default:a(()=>[(S(!0),D(ne,null,xe(e.cols,I=>(S(),R(H,{class:"q-gutter-x-md table__header",key:I.name,props:e},{default:a(()=>[f("span",null,V(I.periodo_id===0?"EGRESOS":I.label),1),I.periodo_id===0?(S(),R(x,{key:0,class:"button-new",label:"Nuevo",color:"traspaso-button",icon:"add_circle",dense:"",onClick:p[5]||(p[5]=G=>ce("2"))})):P("",!0)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"body-cell-nombre_categoria":a(e=>[o(T,{dense:"",props:e,class:"text-primary",style:ge(`border-left: 5px solid ${e.row.color}`)},{default:a(()=>[o(Q,{name:e.row.icono,size:"22px",color:"categoria-icon"},null,8,["name"]),f("span",Sa,V(e.value),1)]),_:2},1032,["props","style"])]),"body-cell":a(e=>[o(T,{dense:"",props:e,clickable:"",onClick:I=>ue(e)},{default:a(()=>[f("span",Ia,V(e.value),1)]),_:2},1032,["props","onClick"])]),_:1},8,["rows","columns","filter"]),o(j,{rows:N.value,columns:U.value,"row-key":"name","hide-header":"","hide-bottom":"",separator:"none",dense:"","table-class":"bg-table-summary"},{"body-cell":a(e=>[o(T,{props:e},{default:a(()=>[Y(V(e.value),1)]),_:2},1032,["props"])]),_:1},8,["rows","columns"]),o(j,{rows:k.value,columns:U.value,"row-key":"name","hide-header":"","hide-bottom":"",separator:"none",dense:""},{"body-cell":a(e=>[o(T,{dense:"",props:e,class:re({"table__body-totals":e.row.categoria_id===1,"table__body-preBalance":e.row.categoria_id===2})},{default:a(()=>[Y(V(e.value),1)]),_:2},1032,["props","class"])]),_:1},8,["rows","columns"]),o(j,{pagination:h.value,"onUpdate:pagination":p[6]||(p[6]=e=>h.value=e),"rows-per-page-options":[0],dense:"",rows:E.value,columns:z.value,"row-key":"id",filter:C.value,separator:"none","hide-pagination":"","hide-bottom":"","hide-header":""},{"body-cell-nombre_categoria":a(e=>[o(T,{dense:"",props:e},{default:a(()=>[o(Q,{name:e.row.icono,size:"22px",color:"dark"},null,8,["name"]),f("span",wa,V(e.value),1)]),_:2},1032,["props"])]),"body-cell":a(e=>[o(T,{dense:"",props:e},{default:a(()=>[f("span",Ca,V(e.value),1)]),_:2},1032,["props"])]),_:1},8,["pagination","rows","columns","filter"]),f("div",qa,[o(j,{rows:_.value,columns:U.value,"row-key":"name","hide-header":"","hide-bottom":"",separator:"cell",dense:""},{"body-cell":a(e=>[o(T,{props:e,class:re({"table__body-netBalance":e.row.categoria_id===2,"table__body-preBalance":e.row.categoria_id===1})},{default:a(()=>[Y(V(e.value),1)]),_:2},1032,["props","class"])]),_:1},8,["rows","columns"])]),(S(),R(Me,{to:"#modal"},[o(ve,{modelValue:X.value,"onUpdate:modelValue":p[7]||(p[7]=e=>X.value=e),persistent:"","transition-show":"jump-up","transition-hide":"jump-down"},{default:a(()=>[o(_o,{"edited-item":M.value,"edited-index":L.value,onMovimientoSaved:qe,onMovimientoUpdated:pe},null,8,["edited-item","edited-index"])]),_:1},8,["modelValue"]),o(ve,{modelValue:K.value,"onUpdate:modelValue":p[8]||(p[8]=e=>K.value=e),persistent:"","transition-show":"jump-up","transition-hide":"jump-down"},{default:a(()=>[o(ma,{"cell-data":$.value,onRegistroCreated:ee,onRegistroUpdated:Ve,onRegistroDeleted:Oe},null,8,["cell-data"])]),_:1},8,["modelValue"]),o(ve,{modelValue:W.value,"onUpdate:modelValue":p[9]||(p[9]=e=>W.value=e),persistent:"","transition-show":"jump-up","transition-hide":"jump-down"},{default:a(()=>[o(no,{"edited-item":Z.value,onCategoriaSaved:s,onCategoriaUpdated:c},null,8,["edited-item"])]),_:1},8,["modelValue"])]))],64))}};var Ha=ae(Va,[["__scopeId","data-v-55811b29"]]);export{Ha as default};
